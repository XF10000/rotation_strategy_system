
<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>增强版回测报告</title>
    <script src="https://cdn.jsdelivr.net/npm/echarts@5.4.3/dist/echarts.min.js"></script>
    <style>
        body { font-family: 'Microsoft YaHei', Arial, sans-serif; margin: 20px; line-height: 1.6; background-color: #f8f9fa; }
        .container { max-width: 1400px; margin: 0 auto; background-color: white; padding: 30px; border-radius: 10px; box-shadow: 0 0 20px rgba(0,0,0,0.1); }
        .header { text-align: center; margin-bottom: 40px; padding: 20px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; border-radius: 10px; }
        .section { margin-bottom: 40px; }
        .section h2 { color: #333; border-bottom: 3px solid #667eea; padding-bottom: 10px; }
        .metrics-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(280px, 1fr)); gap: 20px; margin-bottom: 30px; }
        .metric-card { background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%); padding: 20px; border-radius: 10px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .metric-title { font-weight: bold; color: #333; margin-bottom: 10px; font-size: 14px; }
        .metric-value { font-size: 1.4em; font-weight: bold; }
        .positive { color: #28a745; }
        .negative { color: #dc3545; }
        .highlight-section { background-color: #f8f9fa; padding: 20px; border-radius: 8px; border-left: 4px solid #667eea; }
        .detailed-table { width: 100%; border-collapse: collapse; margin: 20px 0; font-size: 11px; }
        .detailed-table th, .detailed-table td { border: 1px solid #ddd; padding: 6px; text-align: center; }
        .detailed-table th { background-color: #f2f2f2; font-weight: bold; font-size: 10px; }
        .detailed-table tr:nth-child(even) { background-color: #f9f9f9; }
        .detailed-table tr:hover { background-color: #f5f5f5; }
        .signal-legend { font-size: 12px; line-height: 1.4; }
        .stats-table { width: 100%; border-collapse: collapse; margin: 10px 0; }
        .stats-table th, .stats-table td { border: 1px solid #ddd; padding: 8px; text-align: center; }
        .stats-table th { background-color: #f2f2f2; font-weight: bold; }
        .stats-table tr:nth-child(even) { background-color: #f9f9f9; }
        .kline-container { width: 100%; height: 600px; margin: 20px 0; border: 1px solid #ddd; border-radius: 8px; }
        .stock-selector { margin: 20px 0; text-align: center; }
        .stock-selector select { padding: 8px 15px; font-size: 14px; border: 1px solid #ddd; border-radius: 5px; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>🚀 中线轮动策略增强版回测报告</h1>
            <p>生成时间: 2025-07-26 15:29:46</p>
            <p>包含技术指标详情与4维信号分析</p>
        </div>
        
        <div class="section">
            <h2>📊 K线图与交易点分析</h2>
            <div class="stock-selector">
                <label for="stockSelect">选择股票: </label>
                <select id="stockSelect" onchange="switchStock()">
                    <option value="">请选择股票</option>
                </select>
            </div>
            <div id="klineChart" class="kline-container"></div>
        </div>
        
        <div class="section">
            <h2>📈 核心绩效指标</h2>
            <div class="metrics-grid">

                <div class="metric-card">
                    <div class="metric-title">总收益率</div>
                    <div class="metric-value positive">
                        0.40
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">年化收益率</div>
                    <div class="metric-value positive">
                        0.12
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">年化波动率</div>
                    <div class="metric-value ">
                        0.00
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">最大回撤</div>
                    <div class="metric-value negative">
                        -0.14
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">夏普比率</div>
                    <div class="metric-value ">
                        0.000
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">索提诺比率</div>
                    <div class="metric-value ">
                        0.000
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">总交易次数</div>
                    <div class="metric-value ">
                        7
                    </div>
                </div>
                <div class="metric-card">
                    <div class="metric-title">年化换手率</div>
                    <div class="metric-value ">
                        0.00
                    </div>
                </div>
            </div>
        </div>
        
        <div class="section highlight-section">
            <div class="transaction-details">
                <h3>📋 详细交易记录（4维信号状态分析）</h3>
                <div style="overflow-x: auto;">
                    <table class="detailed-table">
                        <thead>
                            <tr>
                                <th rowspan="2">日期</th>
                                <th rowspan="2">类型</th>
                                <th rowspan="2">股票代码</th>
                                <th rowspan="2">价格</th>
                                <th rowspan="2">数量</th>
                                <th colspan="3">趋势过滤器（硬性）</th>
                                <th colspan="2">超买/超卖</th>
                                <th colspan="3">动能确认</th>
                                <th colspan="3">极端价格+量能</th>
                                <th colspan="2">触发分析</th>
                            </tr>
                            <tr>
                                <th>收盘价</th>
                                <th>20周EMA</th>
                                <th>状态</th>
                                <th>14周RSI</th>
                                <th>状态</th>
                                <th>MACD DIF</th>
                                <th>MACD DEA</th>
                                <th>状态</th>
                                <th>布林带位置</th>
                                <th>量能倍数</th>
                                <th>状态</th>
                                <th>满足维度</th>
                                <th>触发原因</th>
                            </tr>
                        </thead>
                        <tbody>

                        <tr>
                            <td>2023-09-08 00:00:00</td>
                            <td><span style="color: green; font-weight: bold;">买入</span></td>
                            <td><strong>002460</strong></td>
                            <td>45.70</td>
                            <td>1,000</td>
                            <td>45.70</td>
                            <td>56.66</td>
                            <td><span style="color: green; font-weight: bold;">✓</span></td>
                            <td style="color: green;">25.8</td>
                            <td><span style="color: green; font-weight: bold;">✓</span></td>
                            <td>-5.6534</td>
                            <td>-4.6104</td>
                            <td><span style="color: red; font-weight: bold;">✗</span></td>
                            <td style="color: orange; font-weight: bold;">下轨之下</td>
                            <td>1.02x</td>
                            <td><span style="color: green; font-weight: bold;">✓</span></td>
                            <td style="font-weight: bold; color: green;">3/4</td>
                            <td style="font-size: 11px;">买入信号：趋势过滤器+2个买入维度</td>
                        </tr>

                        <tr>
                            <td>2023-11-03 00:00:00</td>
                            <td><span style="color: green; font-weight: bold;">买入</span></td>
                            <td><strong>002460</strong></td>
                            <td>42.11</td>
                            <td>1,100</td>
                            <td>42.11</td>
                            <td>50.40</td>
                            <td><span style="color: green; font-weight: bold;">✓</span></td>
                            <td style="color: green;">26.9</td>
                            <td><span style="color: green; font-weight: bold;">✓</span></td>
                            <td>-5.8037</td>
                            <td>-5.6337</td>
                            <td><span style="color: green; font-weight: bold;">✓</span></td>
                            <td style="color: orange; font-weight: bold;">轨道之间</td>
                            <td>0.88x</td>
                            <td><span style="color: red; font-weight: bold;">✗</span></td>
                            <td style="font-weight: bold; color: green;">3/4</td>
                            <td style="font-size: 11px;">买入信号：趋势过滤器+2个买入维度</td>
                        </tr>

                        <tr>
                            <td>2023-12-01 00:00:00</td>
                            <td><span style="color: green; font-weight: bold;">买入</span></td>
                            <td><strong>002460</strong></td>
                            <td>37.83</td>
                            <td>1,200</td>
                            <td>37.83</td>
                            <td>47.35</td>
                            <td><span style="color: green; font-weight: bold;">✓</span></td>
                            <td style="color: green;">24.9</td>
                            <td><span style="color: green; font-weight: bold;">✓</span></td>
                            <td>-5.6514</td>
                            <td>-5.5891</td>
                            <td><span style="color: green; font-weight: bold;">✓</span></td>
                            <td style="color: orange; font-weight: bold;">轨道之间</td>
                            <td>0.87x</td>
                            <td><span style="color: red; font-weight: bold;">✗</span></td>
                            <td style="font-weight: bold; color: green;">3/4</td>
                            <td style="font-size: 11px;">买入信号：趋势过滤器+2个买入维度</td>
                        </tr>

                        <tr>
                            <td>2024-02-02 00:00:00</td>
                            <td><span style="color: green; font-weight: bold;">买入</span></td>
                            <td><strong>002460</strong></td>
                            <td>32.21</td>
                            <td>1,300</td>
                            <td>32.21</td>
                            <td>42.49</td>
                            <td><span style="color: green; font-weight: bold;">✓</span></td>
                            <td style="color: green;">27.7</td>
                            <td><span style="color: red; font-weight: bold;">✗</span></td>
                            <td>-4.4875</td>
                            <td>-4.6654</td>
                            <td><span style="color: green; font-weight: bold;">✓</span></td>
                            <td style="color: orange; font-weight: bold;">下轨之下</td>
                            <td>0.86x</td>
                            <td><span style="color: green; font-weight: bold;">✓</span></td>
                            <td style="font-weight: bold; color: green;">3/4</td>
                            <td style="font-size: 11px;">买入信号：趋势过滤器+2个买入维度</td>
                        </tr>

                        <tr>
                            <td>2024-02-09 00:00:00</td>
                            <td><span style="color: green; font-weight: bold;">买入</span></td>
                            <td><strong>002460</strong></td>
                            <td>33.92</td>
                            <td>1,300</td>
                            <td>33.92</td>
                            <td>41.68</td>
                            <td><span style="color: green; font-weight: bold;">✓</span></td>
                            <td style="color: black;">31.8</td>
                            <td><span style="color: red; font-weight: bold;">✗</span></td>
                            <td>-4.6402</td>
                            <td>-4.6603</td>
                            <td><span style="color: green; font-weight: bold;">✓</span></td>
                            <td style="color: orange; font-weight: bold;">下轨之下</td>
                            <td>0.89x</td>
                            <td><span style="color: green; font-weight: bold;">✓</span></td>
                            <td style="font-weight: bold; color: green;">3/4</td>
                            <td style="font-size: 11px;">买入信号：趋势过滤器+2个买入维度</td>
                        </tr>

                        <tr>
                            <td>2024-02-16 00:00:00</td>
                            <td><span style="color: green; font-weight: bold;">买入</span></td>
                            <td><strong>002460</strong></td>
                            <td>33.92</td>
                            <td>1,300</td>
                            <td>33.92</td>
                            <td>41.68</td>
                            <td><span style="color: green; font-weight: bold;">✓</span></td>
                            <td style="color: black;">31.8</td>
                            <td><span style="color: red; font-weight: bold;">✗</span></td>
                            <td>-4.6402</td>
                            <td>-4.6603</td>
                            <td><span style="color: green; font-weight: bold;">✓</span></td>
                            <td style="color: orange; font-weight: bold;">下轨之下</td>
                            <td>0.89x</td>
                            <td><span style="color: green; font-weight: bold;">✓</span></td>
                            <td style="font-weight: bold; color: green;">3/4</td>
                            <td style="font-size: 11px;">买入信号：趋势过滤器+2个买入维度</td>
                        </tr>

                        <tr>
                            <td>2024-08-02 00:00:00</td>
                            <td><span style="color: red; font-weight: bold;">卖出</span></td>
                            <td><strong>600900</strong></td>
                            <td>29.30</td>
                            <td>1,500</td>
                            <td>29.30</td>
                            <td>26.18</td>
                            <td><span style="color: green; font-weight: bold;">✓</span></td>
                            <td style="color: red;">78.1</td>
                            <td><span style="color: green; font-weight: bold;">✓</span></td>
                            <td>1.7775</td>
                            <td>1.4165</td>
                            <td><span style="color: green; font-weight: bold;">✓</span></td>
                            <td style="color: orange; font-weight: bold;">轨道之间</td>
                            <td>0.85x</td>
                            <td><span style="color: red; font-weight: bold;">✗</span></td>
                            <td style="font-weight: bold; color: green;">3/4</td>
                            <td style="font-size: 11px;">卖出信号：趋势过滤器+2个卖出维度</td>
                        </tr>

                        </tbody>
                    </table>
                </div>
                
                <div class="signal-legend" style="margin-top: 20px; padding: 15px; background: #f8f9fa; border-radius: 8px;">
                    <h4>📖 信号规则说明</h4>
                    <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
                        <div>
                            <strong>🎯 趋势过滤器（硬性条件）：</strong><br>
                            • 阶段高点：收盘价 > 20周EMA 且 EMA向上<br>
                            • 阶段低点：收盘价 < 20周EMA 且 EMA向下
                        </div>
                        <div>
                            <strong>📊 超买/超卖：</strong><br>
                            • 阶段高点：14周RSI > 70 且出现顶背离<br>
                            • 阶段低点：14周RSI < 30 且出现底背离
                        </div>
                        <div>
                            <strong>⚡ 动能确认：</strong><br>
                            • 阶段高点：MACD柱体连续2根缩短 或 DIF死叉DEA<br>
                            • 阶段低点：MACD柱体连续2根缩短 或 DIF金叉DEA
                        </div>
                        <div>
                            <strong>💹 极端价格+量能：</strong><br>
                            • 阶段高点：收盘价≥布林上轨 且 本周量≥4周均量×1.3<br>
                            • 阶段低点：收盘价≤布林下轨 且 本周量≥4周均量×0.8
                        </div>
                    </div>
                    <p style="margin-top: 10px; font-weight: bold; color: #007bff;">
                        ✅ 交易条件：趋势过滤器（硬性）+ 其他3个维度中至少2个满足
                    </p>
                </div>
            </div>
        </div>
        
        <div class="section">
            <div class="signal-statistics">
                <h3>📊 信号统计分析</h3>
                
                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 30px; margin: 20px 0;">
                    <div>
                        <h4>各维度触发频率</h4>
                        <table class="stats-table">
                            <thead>
                                <tr>
                                    <th>维度</th>
                                    <th>满足次数</th>
                                    <th>不满足次数</th>
                                    <th>满足率</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td><strong>趋势过滤器</strong></td>
                                    <td style="color: green;">7</td>
                                    <td style="color: red;">0</td>
                                    <td style="font-weight: bold;">100.0%</td>
                                </tr>
                                <tr>
                                    <td><strong>超买超卖</strong></td>
                                    <td style="color: green;">3</td>
                                    <td style="color: red;">4</td>
                                    <td style="font-weight: bold;">42.9%</td>
                                </tr>
                                <tr>
                                    <td><strong>动能确认</strong></td>
                                    <td style="color: green;">4</td>
                                    <td style="color: red;">3</td>
                                    <td style="font-weight: bold;">57.1%</td>
                                </tr>
                                <tr>
                                    <td><strong>极端价格量能</strong></td>
                                    <td style="color: green;">3</td>
                                    <td style="color: red;">4</td>
                                    <td style="font-weight: bold;">42.9%</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                    
                    <div>
                        <h4>满足维度数量分布</h4>
                        <table class="stats-table">
                            <thead>
                                <tr>
                                    <th>满足维度数</th>
                                    <th>交易次数</th>
                                    <th>占比</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr>
                                    <td style="font-weight: bold;">3/4</td>
                                    <td style="color: green;">7</td>
                                    <td style="font-weight: bold;">100.0%</td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
        </body>
        
        <script>
        // K线图数据
        const chartData = {"kline_data": {}, "trade_points": {}};
        let currentChart = null;
        
        // 初始化股票选择器
        function initStockSelector() {
            const selector = document.getElementById('stockSelect');
            const stocks = Object.keys(chartData.kline_data);
            
            stocks.forEach(stock => {
                const option = document.createElement('option');
                option.value = stock;
                option.textContent = stock;
                selector.appendChild(option);
            });
            
            // 默认选择第一只股票
            if (stocks.length > 0) {
                selector.value = stocks[0];
                switchStock();
            }
        }
        
        // 切换股票
        function switchStock() {
            const stockCode = document.getElementById('stockSelect').value;
            if (stockCode && chartData.kline_data[stockCode]) {
                renderKlineChart(stockCode);
            }
        }
        
        // 渲染K线图
        function renderKlineChart(stockCode) {
            const container = document.getElementById('klineChart');
            
            if (currentChart) {
                currentChart.dispose();
            }
            
            currentChart = echarts.init(container);
            
            const klineData = chartData.kline_data[stockCode];
            const tradePoints = chartData.trade_points[stockCode] || [];
            
            // 准备K线数据
            const dates = klineData.map(item => item[0]);
            const values = klineData.map(item => [item[1], item[2], item[3], item[4]]); // open, close, low, high
            const volumes = klineData.map(item => item[5]);
            
            // 准备交易点数据
            const buyPoints = [];
            const sellPoints = [];
            
            tradePoints.forEach(trade => {
                const dateIndex = dates.indexOf(trade.date);
                if (dateIndex >= 0) {
                    const point = {
                        coord: [dateIndex, trade.price],
                        value: trade.type === 'BUY' ? '买入' : '卖出',
                        itemStyle: {
                            color: trade.type === 'BUY' ? '#ff4757' : '#2ed573'
                        },
                        label: {
                            show: true,
                            formatter: `${trade.type === 'BUY' ? '买入' : '卖出'}\n${trade.price}\n${trade.shares}股`,
                            position: trade.type === 'BUY' ? 'bottom' : 'top',
                            textStyle: {
                                color: trade.type === 'BUY' ? '#ff4757' : '#2ed573',
                                fontSize: 10
                            }
                        }
                    };
                    
                    if (trade.type === 'BUY') {
                        buyPoints.push(point);
                    } else {
                        sellPoints.push(point);
                    }
                }
            });
            
            const option = {
                title: {
                    text: `${stockCode} K线图与交易点`,
                    left: 'center',
                    textStyle: {
                        fontSize: 16,
                        fontWeight: 'bold'
                    }
                },
                tooltip: {
                    trigger: 'axis',
                    axisPointer: {
                        type: 'cross'
                    },
                    formatter: function(params) {
                        let result = params[0].name + '<br/>';
                        params.forEach(param => {
                            if (param.seriesName === 'K线') {
                                const data = param.data;
                                result += `开盘: ${data[1]}<br/>`;
                                result += `收盘: ${data[2]}<br/>`;
                                result += `最低: ${data[3]}<br/>`;
                                result += `最高: ${data[4]}<br/>`;
                            } else if (param.seriesName === '成交量') {
                                result += `成交量: ${param.data}<br/>`;
                            }
                        });
                        return result;
                    }
                },
                legend: {
                    data: ['K线', '成交量', '买入点', '卖出点'],
                    top: 30
                },
                grid: [
                    {
                        left: '10%',
                        right: '8%',
                        height: '50%'
                    },
                    {
                        left: '10%',
                        right: '8%',
                        top: '70%',
                        height: '16%'
                    }
                ],
                xAxis: [
                    {
                        type: 'category',
                        data: dates,
                        scale: true,
                        boundaryGap: false,
                        axisLine: { onZero: false },
                        splitLine: { show: false },
                        min: 'dataMin',
                        max: 'dataMax'
                    },
                    {
                        type: 'category',
                        gridIndex: 1,
                        data: dates,
                        scale: true,
                        boundaryGap: false,
                        axisLine: { onZero: false },
                        axisTick: { show: false },
                        splitLine: { show: false },
                        axisLabel: { show: false },
                        min: 'dataMin',
                        max: 'dataMax'
                    }
                ],
                yAxis: [
                    {
                        scale: true,
                        splitArea: {
                            show: true
                        }
                    },
                    {
                        scale: true,
                        gridIndex: 1,
                        splitNumber: 2,
                        axisLabel: { show: false },
                        axisLine: { show: false },
                        axisTick: { show: false },
                        splitLine: { show: false }
                    }
                ],
                dataZoom: [
                    {
                        type: 'inside',
                        xAxisIndex: [0, 1],
                        start: 80,
                        end: 100
                    },
                    {
                        show: true,
                        xAxisIndex: [0, 1],
                        type: 'slider',
                        top: '85%',
                        start: 80,
                        end: 100
                    }
                ],
                series: [
                    {
                        name: 'K线',
                        type: 'candlestick',
                        data: values,
                        itemStyle: {
                            color: '#ef232a',
                            color0: '#14b143',
                            borderColor: '#ef232a',
                            borderColor0: '#14b143'
                        },
                        markPoint: {
                            data: [...buyPoints, ...sellPoints]
                        }
                    },
                    {
                        name: '成交量',
                        type: 'bar',
                        xAxisIndex: 1,
                        yAxisIndex: 1,
                        data: volumes,
                        itemStyle: {
                            color: function(params) {
                                const klineData = values[params.dataIndex];
                                return klineData[1] > klineData[0] ? '#ef232a' : '#14b143';
                            }
                        }
                    }
                ]
            };
            
            currentChart.setOption(option);
        }
        
        // 页面加载完成后初始化
        document.addEventListener('DOMContentLoaded', function() {
            initStockSelector();
        });
        </script>
        </html>
        