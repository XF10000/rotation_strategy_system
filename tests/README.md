# æµ‹è¯•æ–‡æ¡£

## ğŸ“‹ æµ‹è¯•æ¦‚è¿°

æœ¬é¡¹ç›®åŒ…å«å®Œæ•´çš„æµ‹è¯•å¥—ä»¶ï¼Œè¦†ç›–å•å…ƒæµ‹è¯•ã€é›†æˆæµ‹è¯•å’Œå›å½’æµ‹è¯•ã€‚

## ğŸ—‚ï¸ æµ‹è¯•ç»“æ„

```
tests/
â”œâ”€â”€ services/                    # æœåŠ¡å±‚å•å…ƒæµ‹è¯•
â”‚   â”œâ”€â”€ test_data_service.py    # æ•°æ®æœåŠ¡æµ‹è¯• (20ä¸ªæµ‹è¯•)
â”‚   â”œâ”€â”€ test_portfolio_service.py # æŠ•èµ„ç»„åˆæœåŠ¡æµ‹è¯• (11ä¸ªæµ‹è¯•)
â”‚   â”œâ”€â”€ test_report_service.py  # æŠ¥å‘ŠæœåŠ¡æµ‹è¯• (9ä¸ªæµ‹è¯•)
â”‚   â””â”€â”€ test_signal_service.py  # ä¿¡å·æœåŠ¡æµ‹è¯• (22ä¸ªæµ‹è¯•)
â”œâ”€â”€ regression/                  # å›å½’æµ‹è¯•
â”‚   â”œâ”€â”€ create_baseline.py      # åˆ›å»ºå›å½’æµ‹è¯•åŸºå‡†
â”‚   â”œâ”€â”€ test_regression.py      # å›å½’æµ‹è¯•ç”¨ä¾‹
â”‚   â””â”€â”€ baseline_v1.json        # åŸºå‡†æ•°æ®ï¼ˆè¿è¡Œåç”Ÿæˆï¼‰
â”œâ”€â”€ fixtures/                    # æµ‹è¯•å›ºå®šæ•°æ®
â””â”€â”€ test_services.py            # é›†æˆæµ‹è¯• (7ä¸ªæµ‹è¯•)
```

## ğŸš€ è¿è¡Œæµ‹è¯•

### è¿è¡Œæ‰€æœ‰æµ‹è¯•

```bash
python3 -m pytest tests/ -v
```

### è¿è¡Œç‰¹å®šæ¨¡å—æµ‹è¯•

```bash
# æ•°æ®æœåŠ¡æµ‹è¯•
python3 -m pytest tests/services/test_data_service.py -v

# æŠ•èµ„ç»„åˆæœåŠ¡æµ‹è¯•
python3 -m pytest tests/services/test_portfolio_service.py -v

# ä¿¡å·æœåŠ¡æµ‹è¯•
python3 -m pytest tests/services/test_signal_service.py -v

# æŠ¥å‘ŠæœåŠ¡æµ‹è¯•
python3 -m pytest tests/services/test_report_service.py -v
```

### è¿è¡Œå›å½’æµ‹è¯•

```bash
# 1. é¦–å…ˆåˆ›å»ºåŸºå‡†ï¼ˆä»…éœ€è¿è¡Œä¸€æ¬¡ï¼‰
python3 tests/regression/create_baseline.py

# 2. è¿è¡Œå›å½’æµ‹è¯•
python3 -m pytest tests/regression/test_regression.py -v
```

## ğŸ“Š æµ‹è¯•ç»Ÿè®¡

**å½“å‰æµ‹è¯•è¦†ç›–ï¼š**
- âœ… æ€»æµ‹è¯•æ•°ï¼š62ä¸ª
- âœ… é€šè¿‡ç‡ï¼š100%
- âœ… æµ‹è¯•ä»£ç ï¼š~1635è¡Œ
- âœ… è¦†ç›–æ¨¡å—ï¼š4ä¸ªæ ¸å¿ƒæœåŠ¡å±‚

**æµ‹è¯•åˆ†å¸ƒï¼š**
- æ•°æ®æœåŠ¡ï¼š20ä¸ªæµ‹è¯•
- ä¿¡å·æœåŠ¡ï¼š22ä¸ªæµ‹è¯•
- æŠ•èµ„ç»„åˆæœåŠ¡ï¼š11ä¸ªæµ‹è¯•
- æŠ¥å‘ŠæœåŠ¡ï¼š9ä¸ªæµ‹è¯•

## ğŸ¯ å›å½’æµ‹è¯•

### ä»€ä¹ˆæ˜¯å›å½’æµ‹è¯•ï¼Ÿ

å›å½’æµ‹è¯•ç¡®ä¿ç³»ç»Ÿåœ¨é‡æ„æˆ–ä¿®æ”¹åï¼Œæ ¸å¿ƒåŠŸèƒ½å’Œç»“æœä¿æŒä¸€è‡´ã€‚

### å›å½’æµ‹è¯•æµç¨‹

1. **åˆ›å»ºåŸºå‡†**ï¼šè¿è¡Œä¸€æ¬¡å®Œæ•´å›æµ‹ï¼Œä¿å­˜å…³é”®æŒ‡æ ‡ä½œä¸ºåŸºå‡†
2. **è¿è¡Œå›å½’æµ‹è¯•**ï¼šæ¯æ¬¡ä¿®æ”¹åè¿è¡Œï¼Œå¯¹æ¯”å½“å‰ç»“æœä¸åŸºå‡†
3. **éªŒè¯ä¸€è‡´æ€§**ï¼šç¡®ä¿å…³é”®æŒ‡æ ‡ï¼ˆæ”¶ç›Šç‡ã€å›æ’¤ã€äº¤æ˜“æ¬¡æ•°ç­‰ï¼‰ä¿æŒä¸€è‡´

### å›å½’æµ‹è¯•æŒ‡æ ‡

- æ€»æ”¶ç›Šç‡ï¼ˆå…è®¸0.01%è¯¯å·®ï¼‰
- å¹´åŒ–æ”¶ç›Šç‡ï¼ˆå…è®¸0.01%è¯¯å·®ï¼‰
- æœ€å¤§å›æ’¤ï¼ˆå…è®¸0.01%è¯¯å·®ï¼‰
- å¤æ™®æ¯”ç‡ï¼ˆå…è®¸0.001è¯¯å·®ï¼‰
- ç´¢æè¯ºæ¯”ç‡ï¼ˆå…è®¸0.001è¯¯å·®ï¼‰
- äº¤æ˜“æ¬¡æ•°ï¼ˆå¿…é¡»å®Œå…¨ä¸€è‡´ï¼‰
- æœ€ç»ˆèµ„é‡‘ï¼ˆå…è®¸1å…ƒè¯¯å·®ï¼‰
- ä¿¡å·æ€»æ•°ï¼ˆå¿…é¡»å®Œå…¨ä¸€è‡´ï¼‰

## ğŸ“ ç¼–å†™æ–°æµ‹è¯•

### å•å…ƒæµ‹è¯•ç¤ºä¾‹

```python
import pytest
from services.data_service import DataService

class TestDataService:
    """æ•°æ®æœåŠ¡æµ‹è¯•"""
    
    @pytest.fixture
    def service(self):
        """åˆ›å»ºæµ‹è¯•ç”¨çš„serviceå®ä¾‹"""
        config = {
            'initial_holdings': {'600000': 100},
            'start_date': '2024-01-01',
            'end_date': '2024-12-31'
        }
        return DataService(config)
    
    def test_initialization(self, service):
        """æµ‹è¯•åˆå§‹åŒ–"""
        assert service is not None
        assert service.stock_pool == ['600000']
```

### é›†æˆæµ‹è¯•ç¤ºä¾‹

```python
def test_full_workflow():
    """æµ‹è¯•å®Œæ•´å·¥ä½œæµç¨‹"""
    # 1. å‡†å¤‡é…ç½®
    config = {...}
    
    # 2. åˆ›å»ºæœåŠ¡
    service = MyService(config)
    
    # 3. åˆå§‹åŒ–
    result = service.initialize()
    assert result is True
    
    # 4. æ‰§è¡Œæ“ä½œ
    output = service.do_something()
    assert output is not None
```

## ğŸ”§ æµ‹è¯•æœ€ä½³å®è·µ

1. **ä½¿ç”¨fixture**ï¼šå…±äº«æµ‹è¯•æ•°æ®å’Œè®¾ç½®
2. **ç‹¬ç«‹æ€§**ï¼šæ¯ä¸ªæµ‹è¯•åº”è¯¥ç‹¬ç«‹è¿è¡Œ
3. **æ¸…æ™°å‘½å**ï¼šæµ‹è¯•åç§°åº”è¯¥æè¿°æµ‹è¯•å†…å®¹
4. **æ–­è¨€æ˜ç¡®**ï¼šä½¿ç”¨æ¸…æ™°çš„æ–­è¨€æ¶ˆæ¯
5. **Mockå¤–éƒ¨ä¾èµ–**ï¼šé¿å…ä¾èµ–å¤–éƒ¨èµ„æº

## ğŸ“ˆ æŒç»­æ”¹è¿›

### å½“å‰çŠ¶æ€
- âœ… 62ä¸ªæµ‹è¯•å…¨éƒ¨é€šè¿‡
- âœ… è¦†ç›–æ ¸å¿ƒæœåŠ¡å±‚
- âœ… å›å½’æµ‹è¯•æ¡†æ¶å·²å»ºç«‹

### æœªæ¥è®¡åˆ’
- å¢åŠ æµ‹è¯•è¦†ç›–ç‡åˆ°60%+
- æ·»åŠ æ›´å¤šè¾¹ç•Œæƒ…å†µæµ‹è¯•
- æ€§èƒ½æµ‹è¯•å’Œå‹åŠ›æµ‹è¯•
- è‡ªåŠ¨åŒ–æµ‹è¯•é›†æˆåˆ°CI/CD

## ğŸ› è°ƒè¯•å¤±è´¥çš„æµ‹è¯•

```bash
# æ˜¾ç¤ºè¯¦ç»†é”™è¯¯ä¿¡æ¯
python3 -m pytest tests/ -v --tb=short

# åªè¿è¡Œå¤±è´¥çš„æµ‹è¯•
python3 -m pytest tests/ --lf

# è¿›å…¥è°ƒè¯•æ¨¡å¼
python3 -m pytest tests/ --pdb
```

## ğŸ“š ç›¸å…³æ–‡æ¡£

- [pytestå®˜æ–¹æ–‡æ¡£](https://docs.pytest.org/)
- [unittest.mockæ–‡æ¡£](https://docs.python.org/3/library/unittest.mock.html)
- [æµ‹è¯•é©±åŠ¨å¼€å‘](https://en.wikipedia.org/wiki/Test-driven_development)
