# 中线轮动策略回测系统 v4.2

一个专业的股票轮动策略回测平台，支持技术指标标准化计算、4维信号分析、详细交易记录导出和可视化报告生成。

**项目状态：** ✅ 生产就绪 (v1.0)  
**最后更新：** 2026-01-17  
**测试覆盖：** 70个测试全部通过 (100%通过率)  
**代码质量：** ⭐⭐⭐⭐⭐ (5/5星)

## 📊 项目进度

```
阶段0 ████████████ 100% ✅ 架构文档
阶段1 ████████████ 100% ✅ 配置统一化
阶段2 ████████████ 100% ✅ 服务层重构
阶段3 ██████████░░  80% ✅ Import清理
阶段4 ██████████░░  80% ✅ 数据管道
阶段5 ███████████░  85% ✅ 数据源插件化
阶段6 ████████████ 100% ✅ 单一数据源
阶段7 ████████████ 100% ✅ 测试和文档

总体进度：约 93% (7.45/8个阶段)
```

## 🎯 核心特性

### 🔧 技术指标标准化 (v4.2核心更新)
- **信号一致性保证**: 解决不同回测起始日期产生不同信号的问题
- **RSI稳定性提升**: 差异从2.2降低到0.04，减少98%
- **分层计算策略**: 120条优先→60条回退→全量数据兜底
- **历史数据优化**: 125周历史数据，确保技术指标计算充足性

### 🚀 系统特性
- **4维信号分析**: 价值比过滤器 + 超买超卖 + 动能确认 + 极端价格量能
- **价值投资驱动**: 基于DCF估值的价值比过滤器（V1.1策略）
- **动态RSI阈值**: 124个申万二级行业的个性化阈值
- **渐进式买卖**: 20%固定比例交易，降低市场冲击
- **季度自动更新**: 行业映射和RSI阈值文件季度更新
- **详细CSV导出**: 包含技术指标的完整交易记录

## 🛠️ 快速开始

### 环境要求
- Python 3.8+
- 内存: 4GB+
- 存储: 1GB+

### 安装使用
```bash
# 1. 安装依赖
pip install -r requirements.txt

# 2. 运行回测
python main.py
```

首次运行会自动检查和生成必要的数据文件，后续运行秒级启动。

### 3. 运行测试
```bash
# 运行所有测试
python -m pytest tests/ -v

# 运行单元测试
python -m pytest tests/services/ -v

# 运行回归测试
python -m pytest tests/regression/ -v
```

## 🧪 测试

系统包含完整的测试套件：

**测试统计：**
- ✅ 62个单元测试（服务层100%覆盖）
- ✅ 8个回归测试（关键指标验证）
- ✅ 70个测试全部通过（100%通过率）

**测试文档：**
- 详细使用说明：`tests/README.md`
- 回归测试报告：`PHASE7_FINAL_COMPLETION_REPORT.md`

**创建回归测试基准：**
```bash
python tests/regression/create_baseline.py
```

## 📊 输出文件

### HTML可视化报告
- 交互式K线图与交易点分析
- 基础回测指标分析
- 策略vs基准详细对比
- 4维信号状态分析

### 详细CSV交易记录
包含28列完整数据：技术指标、信号状态、交易成本、仓位变化等。

## 📁 项目结构

```
├── main.py                 # 主程序入口
├── config/                 # 配置管理
├── data/                   # 数据处理模块
├── strategy/               # 策略核心模块
├── backtest/               # 回测引擎
├── utils/                  # 工具模块
├── reports/                # 输出报告目录
└── docs/                   # 文档目录
```

## ⚙️ 配置系统

使用CSV配置文件进行设置：

### 投资组合配置 (`Input/portfolio_config.csv`)
```csv
Stock_number,Stock_name,Initial_weight,Industry,DCF_value_per_share
601088,中国神华,0.0615,煤炭开采,40
600900,长江电力,0.0577,电力,35
CASH,现金,0.0093,,
```

### 回测设置 (`Input/Backtest_settings.csv`)
```csv
Parameter,Value
total_capital,15000000
start_date,2021-01-08
end_date,2025-07-25
```

## 🎯 4维信号框架 (V1.1策略)

1. **价值比过滤器** (硬性条件): 基于DCF估值的价值比判断（买入<70%，卖出>80%）
2. **超买超卖信号**: 基于行业动态RSI阈值（14周RSI，124个行业特定阈值）
3. **动能确认**: MACD信号线和柱体变化（12/26/9参数）
4. **极端价格+量能**: 布林带位置结合成交量放大（20周期布林带，4周均量）

**触发条件**: 价值比过滤器(必须) + 其他3维中至少2维满足

## 💰 渐进式买卖逻辑

- **买入策略**: 无持仓时买入现金20%，有持仓时买入持仓市值20%
- **卖出策略**: 卖出当前持仓20%
- **风险控制**: 100股整数倍、现金检查、持仓保护

## 📚 文档

- [技术说明文档](docs/技术说明文档.md) - 详细的技术实现说明
- [用户使用指南](docs/用户使用指南.md) - 完整的使用和配置指南
- [版本更新记录](docs/版本更新记录.md) - 版本历史和更新日志

## ⚠️ 风险提示

本系统仅用于策略回测和研究，不构成投资建议。实际投资请谨慎决策，投资有风险。
