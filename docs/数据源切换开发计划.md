# Akshare å’Œ Tushare æ•°æ®æºçµæ´»åˆ‡æ¢å¼€å‘è®¡åˆ’

**ç‰ˆæœ¬**: 1.0  
**æ—¥æœŸ**: 2025-12-12  
**çŠ¶æ€**: å¾…å®æ–½  

---

## ğŸ“‹ é¡¹ç›®æ¦‚è¿°

### ç›®æ ‡
å®ç° Akshare å’Œ Tushare ä¸¤ç§æ•°æ®æºä¹‹é—´çš„çµæ´»åˆ‡æ¢ï¼Œæé«˜ç³»ç»Ÿç¨³å®šæ€§å’Œå¯é æ€§ã€‚

### èƒŒæ™¯
å½“å‰ç³»ç»Ÿä½¿ç”¨ Akshare ä½œä¸ºå”¯ä¸€æ•°æ®æºï¼Œä½†ç»å¸¸å‡ºç°è¿æ¥é—®é¢˜ï¼ˆ`RemoteDisconnected` é”™è¯¯ï¼‰ï¼Œå½±å“å›æµ‹çš„ç¨³å®šæ€§ã€‚Tushare æä¾›æ›´ç¨³å®šçš„å®˜æ–¹æ•°æ®æ¥å£ï¼Œè™½ç„¶å…è´¹ç”¨æˆ·æœ‰é¢‘ç‡é™åˆ¶ï¼ˆ200æ¬¡/åˆ†é’Ÿï¼‰ï¼Œä½†å¯¹äºå‘¨çº¿å›æµ‹ç³»ç»Ÿå®Œå…¨å¤Ÿç”¨ã€‚

### æ ¸å¿ƒåŸåˆ™
- âœ… ä¿æŒç°æœ‰ä»£ç é€»è¾‘ä¸å˜
- âœ… é€šè¿‡é…ç½®æ–‡ä»¶æ§åˆ¶æ•°æ®æºé€‰æ‹©
- âœ… æ”¯æŒè‡ªåŠ¨é™çº§å’Œæ™ºèƒ½åˆ‡æ¢
- âœ… å®Œå…¨å‘åå…¼å®¹
- âœ… è¾“å‡ºæ ¼å¼å®Œå…¨ä¸€è‡´

---

## ğŸ¯ äº”é˜¶æ®µå®æ–½è®¡åˆ’

### é˜¶æ®µ 1ï¼šåˆ›å»º TushareDataFetcher ç±»å®ç°

**é¢„è®¡æ—¶é—´**: 2-3 å°æ—¶  
**ä¼˜å…ˆçº§**: é«˜  
**ä¾èµ–**: æ— 

#### 1.1 å®ç°å†…å®¹
åœ¨ `data/data_fetcher.py` ä¸­æ–°å¢ `TushareDataFetcher` ç±»ï¼Œç»§æ‰¿ `DataFetcher` åŸºç±»ã€‚

#### 1.2 æ ¸å¿ƒåŠŸèƒ½

```python
class TushareDataFetcher(DataFetcher):
    """Tushareæ•°æ®è·å–å™¨å®ç°"""
    
    def __init__(self, token: str):
        """
        åˆå§‹åŒ–Tushareæ•°æ®è·å–å™¨
        
        Args:
            token: Tushare API Token
        """
        self.source_name = "tushare"
        self.token = token
        self.pro = ts.pro_api(token)
        self.last_request_time = None
        self.min_request_interval = 0.3  # 200æ¬¡/åˆ†é’Ÿ = æ¯æ¬¡é—´éš”0.3ç§’
        logger.info("åˆå§‹åŒ–Tushareæ•°æ®è·å–å™¨")
    
    def get_stock_data(self, code: str, start_date: str, end_date: str = None, 
                      period: str = 'weekly') -> pd.DataFrame:
        """
        ä»Tushareè·å–è‚¡ç¥¨å†å²æ•°æ®
        
        å®ç°è¦ç‚¹:
        1. è‚¡ç¥¨ä»£ç è½¬æ¢ï¼š601088 -> 601088.SH
        2. æ—¥æœŸæ ¼å¼è½¬æ¢ï¼š'YYYY-MM-DD' -> 'YYYYMMDD'
        3. è°ƒç”¨ pro.daily() è·å–æ—¥çº¿æ•°æ®
        4. å¦‚æœ period='weekly'ï¼Œä»æ—¥çº¿é‡é‡‡æ ·ä¸ºå‘¨çº¿
        5. æ•°æ®æ ‡å‡†åŒ–ï¼ˆä¸ akshare æ ¼å¼ä¸€è‡´ï¼‰
        """
        pass
    
    def get_dividend_data(self, code: str, start_date: str, end_date: str = None,
                         use_cache: bool = True) -> pd.DataFrame:
        """
        è·å–è‚¡ç¥¨åˆ†çº¢é…è‚¡æ•°æ®
        
        å®ç°è¦ç‚¹:
        1. è°ƒç”¨ pro.dividend() è·å–åˆ†çº¢æ•°æ®
        2. æ•°æ®æ ¼å¼æ ‡å‡†åŒ–ï¼ˆä¸ akshare ä¸€è‡´ï¼‰
        3. æ”¯æŒç¼“å­˜æœºåˆ¶
        """
        pass
    
    def _convert_stock_code(self, code: str) -> str:
        """
        è½¬æ¢è‚¡ç¥¨ä»£ç æ ¼å¼
        
        è§„åˆ™:
        - 6å¼€å¤´ -> ä¸Šæµ·äº¤æ˜“æ‰€ (.SH)
        - 0å¼€å¤´ -> æ·±åœ³ä¸»æ¿ (.SZ)
        - 3å¼€å¤´ -> åˆ›ä¸šæ¿ (.SZ)
        
        ç¤ºä¾‹:
        - 600000 -> 600000.SH
        - 000001 -> 000001.SZ
        - 300001 -> 300001.SZ
        """
        if code.startswith('6'):
            return f"{code}.SH"
        elif code.startswith('0') or code.startswith('3'):
            return f"{code}.SZ"
        else:
            raise ValueError(f"æ— æ³•è¯†åˆ«çš„è‚¡ç¥¨ä»£ç : {code}")
    
    def _convert_date_format(self, date_str: str) -> str:
        """
        è½¬æ¢æ—¥æœŸæ ¼å¼
        
        è¾“å…¥: 'YYYY-MM-DD'
        è¾“å‡º: 'YYYYMMDD'
        """
        return date_str.replace('-', '')
    
    def _standardize_data_format(self, df: pd.DataFrame) -> pd.DataFrame:
        """
        æ ‡å‡†åŒ–æ•°æ®æ ¼å¼ï¼Œç¡®ä¿ä¸ AkshareDataFetcher è¾“å‡ºä¸€è‡´
        
        Tushare åˆ—å -> æ ‡å‡†åˆ—å:
        - trade_date -> date
        - ts_code -> (åˆ é™¤)
        - open -> open
        - high -> high
        - low -> low
        - close -> close
        - vol -> volume (æ³¨æ„å•ä½è½¬æ¢ï¼šæ‰‹ -> è‚¡)
        - amount -> amount (æ³¨æ„å•ä½è½¬æ¢ï¼šåƒå…ƒ -> å…ƒ)
        """
        pass
```

#### 1.3 å…³é”®æŠ€æœ¯ç‚¹

1. **è‚¡ç¥¨ä»£ç è½¬æ¢**
   - 6å¼€å¤´ â†’ ä¸Šæµ·äº¤æ˜“æ‰€ (.SH)
   - 0/3å¼€å¤´ â†’ æ·±åœ³äº¤æ˜“æ‰€ (.SZ)

2. **æ—¥æœŸæ ¼å¼è½¬æ¢**
   - è¾“å…¥ï¼š'YYYY-MM-DD'
   - è¾“å‡ºï¼š'YYYYMMDD'

3. **å‘¨çº¿é‡é‡‡æ ·**
   - å¤ç”¨ç°æœ‰ `DataProcessor.resample_to_weekly()` æ–¹æ³•
   - ä»æ—¥çº¿æ•°æ®ç”Ÿæˆå‘¨çº¿æ•°æ®

4. **é¢‘ç‡æ§åˆ¶**
   - å®ç°ä»¤ç‰Œæ¡¶ç®—æ³•
   - é™åˆ¶ 200æ¬¡/åˆ†é’Ÿï¼ˆæ¯æ¬¡é—´éš”0.3ç§’ï¼‰
   - è®°å½•ä¸Šæ¬¡è¯·æ±‚æ—¶é—´ï¼Œè‡ªåŠ¨ç­‰å¾…

5. **æ•°æ®æ ‡å‡†åŒ–**
   - åˆ—åæ˜ å°„ï¼štrade_dateâ†’date, volâ†’volume
   - å•ä½è½¬æ¢ï¼šæˆäº¤é‡ï¼ˆæ‰‹â†’è‚¡ï¼ŒÃ—100ï¼‰ï¼Œæˆäº¤é¢ï¼ˆåƒå…ƒâ†’å…ƒï¼ŒÃ—1000ï¼‰
   - ç´¢å¼•è®¾ç½®ï¼šdate ä½œä¸ºç´¢å¼•
   - æ•°æ®ç±»å‹ï¼šç¡®ä¿æ•°å€¼åˆ—ä¸º float ç±»å‹

6. **é”™è¯¯å¤„ç†**
   - Token æ— æ•ˆ
   - ç½‘ç»œè¿æ¥å¤±è´¥
   - é¢‘ç‡é™åˆ¶è§¦å‘
   - æ•°æ®ç¼ºå¤±

#### 1.4 äº¤ä»˜ç‰©
- âœ… `TushareDataFetcher` ç±»å®Œæ•´å®ç°
- âœ… å•å…ƒæµ‹è¯•ç”¨ä¾‹ï¼ˆæµ‹è¯•æ•°æ®è·å–å’Œæ ¼å¼è½¬æ¢ï¼‰
- âœ… ä»£ç æ³¨é‡Šå’Œæ–‡æ¡£å­—ç¬¦ä¸²

---

### é˜¶æ®µ 2ï¼šå®ç°æ•°æ®æºå·¥å‚æ¨¡å¼

**é¢„è®¡æ—¶é—´**: 1-2 å°æ—¶  
**ä¼˜å…ˆçº§**: é«˜  
**ä¾èµ–**: é˜¶æ®µ1

#### 2.1 åˆ›å»ºå·¥å‚ç±»
åœ¨ `data/data_fetcher.py` ä¸­æ–°å¢ `DataFetcherFactory` ç±»ã€‚

#### 2.2 å·¥å‚æ¨¡å¼å®ç°

```python
class DataFetcherFactory:
    """æ•°æ®è·å–å™¨å·¥å‚ç±»"""
    
    @staticmethod
    def create_fetcher(source_type: str, config: dict = None) -> DataFetcher:
        """
        æ ¹æ®é…ç½®åˆ›å»ºæ•°æ®è·å–å™¨
        
        Args:
            source_type: æ•°æ®æºç±»å‹ ('akshare' æˆ– 'tushare')
            config: é…ç½®å­—å…¸ï¼ŒåŒ…å«:
                - tushare_token: Tushare API Token (ä½¿ç”¨tushareæ—¶å¿…å¡«)
        
        Returns:
            DataFetcher: æ•°æ®è·å–å™¨å®ä¾‹
            
        Raises:
            ValueError: ä¸æ”¯æŒçš„æ•°æ®æºç±»å‹æˆ–ç¼ºå°‘å¿…è¦é…ç½®
            
        ç¤ºä¾‹:
            >>> factory = DataFetcherFactory()
            >>> fetcher = factory.create_fetcher('akshare')
            >>> fetcher = factory.create_fetcher('tushare', {'tushare_token': 'xxx'})
        """
        if config is None:
            config = {}
        
        source_type = source_type.lower().strip()
        
        if source_type == 'akshare':
            logger.info("åˆ›å»º Akshare æ•°æ®è·å–å™¨")
            return AkshareDataFetcher()
            
        elif source_type == 'tushare':
            token = config.get('tushare_token')
            if not token:
                raise ValueError("ä½¿ç”¨ Tushare æ•°æ®æºéœ€è¦æä¾› tushare_token")
            logger.info("åˆ›å»º Tushare æ•°æ®è·å–å™¨")
            return TushareDataFetcher(token)
            
        else:
            raise ValueError(f"ä¸æ”¯æŒçš„æ•°æ®æºç±»å‹: {source_type}ï¼Œæ”¯æŒçš„ç±»å‹: akshare, tushare")
    
    @staticmethod
    def create_with_fallback(primary: str, backup: str, config: dict) -> DataFetcher:
        """
        åˆ›å»ºå¸¦é™çº§çš„æ•°æ®è·å–å™¨
        
        å°è¯•åˆ›å»ºä¸»æ•°æ®æºï¼Œå¦‚æœå¤±è´¥åˆ™è‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨æ•°æ®æº
        
        Args:
            primary: ä¸»æ•°æ®æºç±»å‹
            backup: å¤‡ç”¨æ•°æ®æºç±»å‹
            config: é…ç½®å­—å…¸
            
        Returns:
            DataFetcher: æˆåŠŸåˆ›å»ºçš„æ•°æ®è·å–å™¨å®ä¾‹
            
        ç¤ºä¾‹:
            >>> fetcher = DataFetcherFactory.create_with_fallback(
            ...     primary='akshare',
            ...     backup='tushare',
            ...     config={'tushare_token': 'xxx'}
            ... )
        """
        try:
            logger.info(f"å°è¯•åˆå§‹åŒ–ä¸»æ•°æ®æº: {primary}")
            return DataFetcherFactory.create_fetcher(primary, config)
        except Exception as e:
            logger.warning(f"ä¸»æ•°æ®æº {primary} åˆå§‹åŒ–å¤±è´¥: {e}")
            logger.info(f"åˆ‡æ¢åˆ°å¤‡ç”¨æ•°æ®æº: {backup}")
            return DataFetcherFactory.create_fetcher(backup, config)
```

#### 2.3 æ™ºèƒ½åˆ‡æ¢è£…é¥°å™¨ï¼ˆå¯é€‰å¢å¼ºåŠŸèƒ½ï¼‰

```python
class SmartDataFetcher:
    """
    æ™ºèƒ½æ•°æ®è·å–å™¨ - æ”¯æŒè‡ªåŠ¨é™çº§
    
    å½“ä¸»æ•°æ®æºè¿ç»­å¤±è´¥è¾¾åˆ°é˜ˆå€¼æ—¶ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ°å¤‡ç”¨æ•°æ®æº
    """
    
    def __init__(self, primary_fetcher: DataFetcher, backup_fetcher: DataFetcher = None):
        """
        åˆå§‹åŒ–æ™ºèƒ½æ•°æ®è·å–å™¨
        
        Args:
            primary_fetcher: ä¸»æ•°æ®è·å–å™¨
            backup_fetcher: å¤‡ç”¨æ•°æ®è·å–å™¨ï¼ˆå¯é€‰ï¼‰
        """
        self.primary = primary_fetcher
        self.backup = backup_fetcher
        self.failure_count = 0
        self.max_failures = 3  # è¿ç»­å¤±è´¥3æ¬¡ååˆ‡æ¢
        self.current_fetcher = primary_fetcher
        logger.info(f"åˆå§‹åŒ–æ™ºèƒ½æ•°æ®è·å–å™¨: ä¸»={primary_fetcher.source_name}, "
                   f"å¤‡ç”¨={backup_fetcher.source_name if backup_fetcher else 'None'}")
    
    def get_stock_data(self, *args, **kwargs) -> pd.DataFrame:
        """
        è·å–è‚¡ç¥¨æ•°æ®ï¼Œæ”¯æŒè‡ªåŠ¨é™çº§
        """
        try:
            data = self.current_fetcher.get_stock_data(*args, **kwargs)
            self.failure_count = 0  # æˆåŠŸåé‡ç½®å¤±è´¥è®¡æ•°
            return data
            
        except Exception as e:
            self.failure_count += 1
            logger.warning(f"æ•°æ®è·å–å¤±è´¥ ({self.failure_count}/{self.max_failures}): {e}")
            
            # å¦‚æœæœ‰å¤‡ç”¨æ•°æ®æºä¸”è¾¾åˆ°å¤±è´¥é˜ˆå€¼ï¼Œåˆ‡æ¢åˆ°å¤‡ç”¨
            if self.backup and self.failure_count >= self.max_failures:
                logger.warning(f"ä¸»æ•°æ®æºè¿ç»­å¤±è´¥ {self.failure_count} æ¬¡ï¼Œåˆ‡æ¢åˆ°å¤‡ç”¨æ•°æ®æº")
                self.current_fetcher = self.backup
                self.failure_count = 0
                return self.backup.get_stock_data(*args, **kwargs)
            
            raise
    
    def get_dividend_data(self, *args, **kwargs) -> pd.DataFrame:
        """
        è·å–åˆ†çº¢æ•°æ®ï¼Œæ”¯æŒè‡ªåŠ¨é™çº§
        """
        try:
            data = self.current_fetcher.get_dividend_data(*args, **kwargs)
            return data
        except Exception as e:
            if self.backup:
                logger.warning(f"ä¸»æ•°æ®æºè·å–åˆ†çº¢æ•°æ®å¤±è´¥ï¼Œå°è¯•å¤‡ç”¨æ•°æ®æº: {e}")
                return self.backup.get_dividend_data(*args, **kwargs)
            raise
```

#### 2.4 äº¤ä»˜ç‰©
- âœ… `DataFetcherFactory` å·¥å‚ç±»å®ç°
- âœ… `SmartDataFetcher` æ™ºèƒ½åˆ‡æ¢ç±»å®ç°ï¼ˆå¯é€‰ï¼‰
- âœ… å·¥å‚æ¨¡å¼å•å…ƒæµ‹è¯•
- âœ… ä½¿ç”¨ç¤ºä¾‹å’Œæ–‡æ¡£

---

### é˜¶æ®µ 3ï¼šæ›´æ–° BacktestEngine é›†æˆæ•°æ®æºåˆ‡æ¢

**é¢„è®¡æ—¶é—´**: 2-3 å°æ—¶  
**ä¼˜å…ˆçº§**: é«˜  
**ä¾èµ–**: é˜¶æ®µ2

#### 3.1 ä¿®æ”¹ BacktestEngine åˆå§‹åŒ–

åœ¨ `backtest/backtest_engine.py` ä¸­ä¿®æ”¹æ•°æ®è·å–å™¨åˆå§‹åŒ–é€»è¾‘ã€‚

```python
class BacktestEngine:
    def __init__(self, config):
        """
        åˆå§‹åŒ–å›æµ‹å¼•æ“
        
        Args:
            config: é…ç½®å­—å…¸ï¼ŒåŒ…å«:
                - data_source: ä¸»æ•°æ®æº ('akshare' æˆ– 'tushare')
                - backup_data_source: å¤‡ç”¨æ•°æ®æºï¼ˆå¯é€‰ï¼‰
                - tushare_token: Tushare Tokenï¼ˆä½¿ç”¨tushareæ—¶å¿…å¡«ï¼‰
                - data_fetch_strategy: æ•°æ®è·å–ç­–ç•¥ ('smart' æˆ– 'simple')
        """
        # ... ç°æœ‰ä»£ç  ...
        
        # ã€æ–°å¢ã€‘ä»é…ç½®è¯»å–æ•°æ®æºè®¾ç½®
        data_source = config.get('data_source', 'akshare')
        backup_source = config.get('backup_data_source', None)
        tushare_token = config.get('tushare_token', None)
        fetch_strategy = config.get('data_fetch_strategy', 'simple')
        
        # ã€ä¿®æ”¹ã€‘ä½¿ç”¨å·¥å‚æ¨¡å¼åˆ›å»ºæ•°æ®è·å–å™¨
        from data.data_fetcher import DataFetcherFactory, SmartDataFetcher
        
        fetcher_config = {
            'tushare_token': tushare_token
        }
        
        # æ ¹æ®ç­–ç•¥é€‰æ‹©åˆ›å»ºæ–¹å¼
        if fetch_strategy == 'smart' and backup_source:
            # æ™ºèƒ½åˆ‡æ¢æ¨¡å¼ï¼šä¸»æ•°æ®æº + å¤‡ç”¨æ•°æ®æº
            logger.info(f"ğŸ”„ ä½¿ç”¨æ™ºèƒ½åˆ‡æ¢æ¨¡å¼")
            primary = DataFetcherFactory.create_fetcher(data_source, fetcher_config)
            backup = DataFetcherFactory.create_fetcher(backup_source, fetcher_config)
            self.data_fetcher = SmartDataFetcher(primary, backup)
            logger.info(f"âœ… æ•°æ®æºåˆå§‹åŒ–: {data_source} (å¤‡ç”¨: {backup_source})")
            
        elif backup_source:
            # é™çº§æ¨¡å¼ï¼šå°è¯•ä¸»æ•°æ®æºï¼Œå¤±è´¥æ—¶ä½¿ç”¨å¤‡ç”¨
            logger.info(f"ğŸ”„ ä½¿ç”¨é™çº§æ¨¡å¼")
            self.data_fetcher = DataFetcherFactory.create_with_fallback(
                data_source, backup_source, fetcher_config
            )
            logger.info(f"âœ… æ•°æ®æºåˆå§‹åŒ–å®Œæˆ")
            
        else:
            # å•ä¸€æ•°æ®æºæ¨¡å¼
            logger.info(f"ğŸ“Š ä½¿ç”¨å•ä¸€æ•°æ®æºæ¨¡å¼")
            self.data_fetcher = DataFetcherFactory.create_fetcher(data_source, fetcher_config)
            logger.info(f"âœ… æ•°æ®æºåˆå§‹åŒ–: {data_source}")
        
        # ... å…¶ä½™ç°æœ‰ä»£ç ä¿æŒä¸å˜ ...
```

#### 3.2 æ›´æ–°é…ç½®åŠ è½½å™¨

åœ¨ `config/csv_config_loader.py` ä¸­æ·»åŠ æ•°æ®æºé…ç½®è¯»å–ï¼š

```python
def create_csv_config():
    """
    ä»CSVæ–‡ä»¶åŠ è½½å›æµ‹é…ç½®
    
    æ–°å¢é…ç½®é¡¹:
    - data_source: ä¸»æ•°æ®æº
    - backup_data_source: å¤‡ç”¨æ•°æ®æº
    - tushare_token: Tushare Token
    - data_fetch_strategy: æ•°æ®è·å–ç­–ç•¥
    """
    # ... ç°æœ‰ä»£ç  ...
    
    # ã€æ–°å¢ã€‘è¯»å–æ•°æ®æºé…ç½®
    def get_config_value(param_name, default=None):
        """å®‰å…¨è·å–é…ç½®å€¼"""
        if param_name in settings_df['Parameter'].values:
            return settings_df[settings_df['Parameter'] == param_name]['Value'].values[0]
        return default
    
    config['data_source'] = get_config_value('data_source', 'akshare')
    config['backup_data_source'] = get_config_value('backup_data_source', None)
    config['tushare_token'] = get_config_value('tushare_token', None)
    config['data_fetch_strategy'] = get_config_value('data_fetch_strategy', 'simple')
    
    # éªŒè¯é…ç½®
    if config['data_source'] == 'tushare' and not config['tushare_token']:
        logger.warning("âš ï¸ ä½¿ç”¨ Tushare æ•°æ®æºä½†æœªé…ç½® tokenï¼Œå°†å°è¯•ä»ç¯å¢ƒå˜é‡è¯»å–")
        import os
        config['tushare_token'] = os.getenv('TUSHARE_TOKEN')
        if not config['tushare_token']:
            raise ValueError("ä½¿ç”¨ Tushare æ•°æ®æºéœ€è¦é…ç½® tushare_token")
    
    # ... å…¶ä½™ç°æœ‰ä»£ç  ...
    
    return config
```

#### 3.3 æ—¥å¿—è¾“å‡ºä¼˜åŒ–

åœ¨å…³é”®ä½ç½®æ·»åŠ æ—¥å¿—è¾“å‡ºï¼Œæ–¹ä¾¿è°ƒè¯•å’Œç›‘æ§ï¼š

```python
# æ•°æ®è·å–æ—¶è®°å½•æ•°æ®æº
logger.info(f"ğŸ“Š ä½¿ç”¨ {self.data_fetcher.source_name} è·å– {stock_code} æ•°æ®")

# æ•°æ®æºåˆ‡æ¢æ—¶è®°å½•
logger.warning(f"ğŸ”„ æ•°æ®æºå·²åˆ‡æ¢: {old_source} -> {new_source}")

# æ•°æ®è·å–æˆåŠŸæ—¶è®°å½•
logger.info(f"âœ… æˆåŠŸè·å– {stock_code} æ•°æ®: {len(data)} æ¡è®°å½• (æ¥æº: {source})")
```

#### 3.4 äº¤ä»˜ç‰©
- âœ… BacktestEngine æ•°æ®æºé›†æˆå®Œæˆ
- âœ… é…ç½®åŠ è½½å™¨æ›´æ–°å®Œæˆ
- âœ… æ—¥å¿—è¾“å‡ºä¼˜åŒ–å®Œæˆ
- âœ… å‘åå…¼å®¹æ€§éªŒè¯

---

### é˜¶æ®µ 4ï¼šé…ç½®æ–‡ä»¶å¢å¼ºå’Œæ–‡æ¡£æ›´æ–°

**é¢„è®¡æ—¶é—´**: 1 å°æ—¶  
**ä¼˜å…ˆçº§**: ä¸­  
**ä¾èµ–**: é˜¶æ®µ3

#### 4.1 æ›´æ–° `Input/Backtest_settings.csv`

```csv
Parameter,Value,Description
# ========== æ•°æ®æºé…ç½® ==========,,
data_source,akshare,ä¸»æ•°æ®æº (akshare/tushare)
backup_data_source,tushare,å¤‡ç”¨æ•°æ®æº (akshare/tushare/none) - å¯é€‰
tushare_token,YOUR_TOKEN_HERE,Tushare API Token - ä½¿ç”¨tushareæ—¶å¿…å¡«
data_fetch_strategy,smart,æ•°æ®è·å–ç­–ç•¥ (smart:æ™ºèƒ½åˆ‡æ¢/simple:å•ä¸€æ•°æ®æº)
# ========== å›æµ‹åŸºç¡€é…ç½® ==========,,
total_capital,100000000,å›æµ‹æ€»èµ„æœ¬
start_date,2024-01-12,å›æµ‹å¼€å§‹æ—¥æœŸ
end_date,2025-12-12,å›æµ‹ç»“æŸæ—¥æœŸ
...
```

#### 4.2 æ›´æ–° `config/settings.py`

```python
# æ•°æ®æºé…ç½®
DATA_SOURCE = {
    'primary': 'akshare',          # ä¸»è¦æ•°æ®æº: akshare/tushare
    'backup': None,                # å¤‡ç”¨æ•°æ®æº: akshare/tushare/None
    'tushare_token': None,         # Tushare Token (ä»ç¯å¢ƒå˜é‡æˆ–é…ç½®æ–‡ä»¶è¯»å–)
    'fetch_strategy': 'simple',    # æ•°æ®è·å–ç­–ç•¥: smart/simple
    'cache_enabled': True,         # æ˜¯å¦å¯ç”¨ç¼“å­˜
    'cache_days': 7,               # ç¼“å­˜å¤©æ•°
    'max_retry': 3,                # æœ€å¤§é‡è¯•æ¬¡æ•°
    'request_interval': {          # è¯·æ±‚é—´éš”ï¼ˆç§’ï¼‰
        'akshare': 3.0,
        'tushare': 0.3
    }
}
```

#### 4.3 åˆ›å»ºæ•°æ®æºåˆ‡æ¢æŒ‡å—

åˆ›å»º `docs/æ•°æ®æºåˆ‡æ¢ä½¿ç”¨æŒ‡å—.md`ï¼š

```markdown
# æ•°æ®æºåˆ‡æ¢ä½¿ç”¨æŒ‡å—

## å¿«é€Ÿå¼€å§‹

### æ–¹æ¡ˆä¸€ï¼šä½¿ç”¨ Akshareï¼ˆé»˜è®¤ï¼Œæ— éœ€é…ç½®ï¼‰

**ä¼˜ç‚¹**ï¼š
- âœ… æ— éœ€æ³¨å†Œï¼Œå¼€ç®±å³ç”¨
- âœ… æ— é¢‘ç‡é™åˆ¶
- âœ… æ•°æ®æ›´æ–°å¿«

**ç¼ºç‚¹**ï¼š
- âš ï¸ è¿æ¥ä¸ç¨³å®šï¼Œç»å¸¸å‡ºç° `RemoteDisconnected` é”™è¯¯
- âš ï¸ çˆ¬è™«æ•°æ®ï¼Œå¶æœ‰å»¶è¿Ÿ

**é…ç½®**ï¼š
```csv
data_source,akshare
```

### æ–¹æ¡ˆäºŒï¼šåˆ‡æ¢åˆ° Tushareï¼ˆæ¨èç”Ÿäº§ç¯å¢ƒï¼‰

**ä¼˜ç‚¹**ï¼š
- âœ… å®˜æ–¹æ•°æ®ï¼Œç¨³å®šå¯é 
- âœ… æ•°æ®è´¨é‡é«˜
- âœ… æœ‰æŠ€æœ¯æ”¯æŒ

**ç¼ºç‚¹**ï¼š
- âš ï¸ éœ€è¦æ³¨å†Œè´¦å·
- âš ï¸ å…è´¹ç”¨æˆ·æœ‰é¢‘ç‡é™åˆ¶ï¼ˆ200æ¬¡/åˆ†é’Ÿï¼‰

**é…ç½®æ­¥éª¤**ï¼š

1. **æ³¨å†Œ Tushare è´¦å·**
   - è®¿é—®ï¼šhttps://tushare.pro/register
   - æ³¨å†Œåè·å– Token

2. **ä¿®æ”¹é…ç½®æ–‡ä»¶** `Input/Backtest_settings.csv`ï¼š
   ```csv
   data_source,tushare
   tushare_token,YOUR_TOKEN_HERE
   ```

3. **è¿è¡Œå›æµ‹**
   ```bash
   python3 main.py
   ```

### æ–¹æ¡ˆä¸‰ï¼šæ™ºèƒ½åˆ‡æ¢æ¨¡å¼ï¼ˆæœ€ä½³æ–¹æ¡ˆï¼‰

**ä¼˜ç‚¹**ï¼š
- âœ… ç»“åˆä¸¤ç§æ•°æ®æºçš„ä¼˜ç‚¹
- âœ… ä¸»æ•°æ®æºå¤±è´¥æ—¶è‡ªåŠ¨åˆ‡æ¢
- âœ… æœ€å¤§åŒ–ç³»ç»Ÿç¨³å®šæ€§

**é…ç½®**ï¼š
```csv
data_source,akshare
backup_data_source,tushare
tushare_token,YOUR_TOKEN_HERE
data_fetch_strategy,smart
```

**å·¥ä½œåŸç†**ï¼š
1. ä¼˜å…ˆä½¿ç”¨ Akshare è·å–æ•°æ®
2. å¦‚æœ Akshare è¿ç»­å¤±è´¥ 3 æ¬¡ï¼Œè‡ªåŠ¨åˆ‡æ¢åˆ° Tushare
3. åˆ‡æ¢åç»§ç»­ä½¿ç”¨ Tushareï¼Œç›´åˆ°ç¨‹åºé‡å¯

## æ•°æ®æºå¯¹æ¯”

| ç‰¹æ€§ | Akshare | Tushare |
|------|---------|---------|
| **ç¨³å®šæ€§** | â­â­â­ | â­â­â­â­â­ |
| **æ•°æ®è´¨é‡** | â­â­â­â­ | â­â­â­â­â­ |
| **å…è´¹é¢åº¦** | æ— é™åˆ¶ | 200æ¬¡/åˆ†é’Ÿ |
| **æ³¨å†Œè¦æ±‚** | æ—  | éœ€è¦æ³¨å†Œ |
| **å®æ—¶æ€§** | æ”¶ç›˜åå³æ—¶ | æ”¶ç›˜å30-60åˆ†é’Ÿ |
| **æ¨èåœºæ™¯** | å¿«é€Ÿæµ‹è¯• | ç”Ÿäº§ç¯å¢ƒ |

## å¸¸è§é—®é¢˜

### Q1: Tushare çš„ 200æ¬¡/åˆ†é’Ÿ å¤Ÿç”¨å—ï¼Ÿ

**A**: å®Œå…¨å¤Ÿç”¨ã€‚å¯¹äºå‘¨çº¿å›æµ‹ç³»ç»Ÿï¼š
- å‡è®¾å›æµ‹ 10 åªè‚¡ç¥¨ï¼Œæ¯åªè‚¡ç¥¨éœ€è¦ 2 æ¬¡è¯·æ±‚ï¼ˆè¡Œæƒ…+åˆ†çº¢ï¼‰
- æ€»å…±éœ€è¦ 20 æ¬¡è¯·æ±‚
- è¿œä½äº 200æ¬¡/åˆ†é’Ÿ çš„é™åˆ¶

### Q2: å¦‚ä½•è·å– Tushare Tokenï¼Ÿ

**A**: 
1. è®¿é—® https://tushare.pro/register æ³¨å†Œè´¦å·
2. ç™»å½•åè®¿é—® https://tushare.pro/user/token
3. å¤åˆ¶ Token åˆ°é…ç½®æ–‡ä»¶

### Q3: å¯ä»¥åŒæ—¶ä½¿ç”¨ä¸¤ç§æ•°æ®æºå—ï¼Ÿ

**A**: å¯ä»¥ï¼Œä½¿ç”¨æ™ºèƒ½åˆ‡æ¢æ¨¡å¼ï¼ˆæ–¹æ¡ˆä¸‰ï¼‰ã€‚

### Q4: æ•°æ®æ ¼å¼æ˜¯å¦ä¸€è‡´ï¼Ÿ

**A**: æ˜¯çš„ï¼Œç³»ç»Ÿä¼šè‡ªåŠ¨æ ‡å‡†åŒ–ä¸¤ç§æ•°æ®æºçš„è¾“å‡ºæ ¼å¼ï¼Œç¡®ä¿å®Œå…¨ä¸€è‡´ã€‚

### Q5: å¦‚ä½•éªŒè¯æ•°æ®æºæ˜¯å¦æ­£å¸¸å·¥ä½œï¼Ÿ

**A**: æŸ¥çœ‹æ—¥å¿—è¾“å‡ºï¼Œä¼šæ˜¾ç¤ºå½“å‰ä½¿ç”¨çš„æ•°æ®æºï¼š
```
âœ… æ•°æ®æºåˆå§‹åŒ–: tushare
ğŸ“Š ä½¿ç”¨ tushare è·å– 601088 æ•°æ®
âœ… æˆåŠŸè·å– 601088 æ•°æ®: 235 æ¡è®°å½• (æ¥æº: tushare)
```

## ç¯å¢ƒå˜é‡é…ç½®ï¼ˆå¯é€‰ï¼‰

å¦‚æœä¸æƒ³åœ¨é…ç½®æ–‡ä»¶ä¸­æ˜æ–‡ä¿å­˜ Tokenï¼Œå¯ä»¥ä½¿ç”¨ç¯å¢ƒå˜é‡ï¼š

```bash
# macOS/Linux
export TUSHARE_TOKEN="your_token_here"

# Windows
set TUSHARE_TOKEN=your_token_here
```

ç„¶ååœ¨é…ç½®æ–‡ä»¶ä¸­ç•™ç©ºï¼š
```csv
tushare_token,
```

ç³»ç»Ÿä¼šè‡ªåŠ¨ä»ç¯å¢ƒå˜é‡è¯»å–ã€‚

## æŠ€æœ¯æ”¯æŒ

å¦‚æœ‰é—®é¢˜ï¼Œè¯·æŸ¥çœ‹ï¼š
- Tushare å®˜æ–¹æ–‡æ¡£ï¼šhttps://tushare.pro/document/2
- Akshare å®˜æ–¹æ–‡æ¡£ï¼šhttps://akshare.akfamily.xyz/
```

#### 4.4 æ›´æ–°ä¸»æ–‡æ¡£

æ›´æ–° `README.md`ï¼Œæ·»åŠ æ•°æ®æºé…ç½®ç« èŠ‚ï¼š

```markdown
## æ•°æ®æºé…ç½®

æœ¬ç³»ç»Ÿæ”¯æŒä¸¤ç§æ•°æ®æºï¼š

- **Akshare**ï¼šå…è´¹ï¼Œæ— éœ€æ³¨å†Œï¼Œä½†è¿æ¥ä¸ç¨³å®š
- **Tushare**ï¼šéœ€è¦æ³¨å†Œï¼Œç¨³å®šå¯é ï¼ˆæ¨èï¼‰

è¯¦ç»†é…ç½®æ–¹æ³•è¯·å‚è€ƒï¼š[æ•°æ®æºåˆ‡æ¢ä½¿ç”¨æŒ‡å—](docs/æ•°æ®æºåˆ‡æ¢ä½¿ç”¨æŒ‡å—.md)
```

æ›´æ–° `docs/ç”¨æˆ·ä½¿ç”¨æŒ‡å—.md`ï¼Œæ·»åŠ æ•°æ®æºé…ç½®è¯´æ˜ã€‚

#### 4.5 åˆ›å»ºé…ç½®æ¨¡æ¿

åˆ›å»º `Input/Backtest_settings_template.csv` ä½œä¸ºé…ç½®æ¨¡æ¿ï¼š

```csv
# æ•°æ®æºé…ç½®æ¨¡æ¿
# æ–¹æ¡ˆä¸€ï¼šä»…ä½¿ç”¨ Akshare
data_source,akshare

# æ–¹æ¡ˆäºŒï¼šä»…ä½¿ç”¨ Tushare
# data_source,tushare
# tushare_token,YOUR_TOKEN_HERE

# æ–¹æ¡ˆä¸‰ï¼šæ™ºèƒ½åˆ‡æ¢ï¼ˆæ¨èï¼‰
# data_source,akshare
# backup_data_source,tushare
# tushare_token,YOUR_TOKEN_HERE
# data_fetch_strategy,smart
```

#### 4.6 äº¤ä»˜ç‰©
- âœ… é…ç½®æ–‡ä»¶æ¨¡æ¿æ›´æ–°
- âœ… æ•°æ®æºåˆ‡æ¢ä½¿ç”¨æŒ‡å—æ–‡æ¡£
- âœ… README.md æ›´æ–°
- âœ… ç”¨æˆ·ä½¿ç”¨æŒ‡å—æ›´æ–°
- âœ… é…ç½®æ¨¡æ¿æ–‡ä»¶

---

### é˜¶æ®µ 5ï¼šæµ‹è¯•éªŒè¯å’Œå›å½’æµ‹è¯•

**é¢„è®¡æ—¶é—´**: 2-3 å°æ—¶  
**ä¼˜å…ˆçº§**: é«˜  
**ä¾èµ–**: é˜¶æ®µ4

#### 5.1 å•å…ƒæµ‹è¯•

åˆ›å»º `tests/test_data_fetcher.py`ï¼š

```python
import unittest
import pandas as pd
from data.data_fetcher import (
    AkshareDataFetcher, 
    TushareDataFetcher,
    DataFetcherFactory,
    SmartDataFetcher
)

class TestAkshareFetcher(unittest.TestCase):
    """æµ‹è¯• Akshare æ•°æ®è·å–å™¨"""
    
    def setUp(self):
        self.fetcher = AkshareDataFetcher()
    
    def test_get_stock_data(self):
        """æµ‹è¯•è·å–è‚¡ç¥¨æ•°æ®"""
        data = self.fetcher.get_stock_data('601088', '2024-01-01', '2024-12-31', 'daily')
        self.assertIsInstance(data, pd.DataFrame)
        self.assertIn('close', data.columns)
        self.assertIn('volume', data.columns)
    
    def test_get_dividend_data(self):
        """æµ‹è¯•è·å–åˆ†çº¢æ•°æ®"""
        data = self.fetcher.get_dividend_data('601088', '2020-01-01', '2024-12-31')
        self.assertIsInstance(data, pd.DataFrame)

class TestTushareFetcher(unittest.TestCase):
    """æµ‹è¯• Tushare æ•°æ®è·å–å™¨"""
    
    def setUp(self):
        # éœ€è¦æœ‰æ•ˆçš„ token
        self.token = "YOUR_TEST_TOKEN"
        self.fetcher = TushareDataFetcher(self.token)
    
    def test_convert_stock_code(self):
        """æµ‹è¯•è‚¡ç¥¨ä»£ç è½¬æ¢"""
        self.assertEqual(self.fetcher._convert_stock_code('600000'), '600000.SH')
        self.assertEqual(self.fetcher._convert_stock_code('000001'), '000001.SZ')
        self.assertEqual(self.fetcher._convert_stock_code('300001'), '300001.SZ')
    
    def test_get_stock_data(self):
        """æµ‹è¯•è·å–è‚¡ç¥¨æ•°æ®"""
        data = self.fetcher.get_stock_data('601088', '2024-01-01', '2024-12-31', 'daily')
        self.assertIsInstance(data, pd.DataFrame)
        self.assertIn('close', data.columns)
        self.assertIn('volume', data.columns)

class TestDataFormatConsistency(unittest.TestCase):
    """æµ‹è¯•ä¸¤ç§æ•°æ®æºè¾“å‡ºæ ¼å¼ä¸€è‡´æ€§"""
    
    def setUp(self):
        self.akshare_fetcher = AkshareDataFetcher()
        self.tushare_fetcher = TushareDataFetcher("YOUR_TEST_TOKEN")
    
    def test_column_names_consistency(self):
        """æµ‹è¯•åˆ—åä¸€è‡´æ€§"""
        ak_data = self.akshare_fetcher.get_stock_data('601088', '2024-01-01', '2024-01-31')
        ts_data = self.tushare_fetcher.get_stock_data('601088', '2024-01-01', '2024-01-31')
        
        self.assertEqual(set(ak_data.columns), set(ts_data.columns))
    
    def test_data_types_consistency(self):
        """æµ‹è¯•æ•°æ®ç±»å‹ä¸€è‡´æ€§"""
        ak_data = self.akshare_fetcher.get_stock_data('601088', '2024-01-01', '2024-01-31')
        ts_data = self.tushare_fetcher.get_stock_data('601088', '2024-01-01', '2024-01-31')
        
        for col in ['open', 'high', 'low', 'close', 'volume']:
            self.assertEqual(ak_data[col].dtype, ts_data[col].dtype)

class TestFactoryPattern(unittest.TestCase):
    """æµ‹è¯•å·¥å‚æ¨¡å¼"""
    
    def test_create_akshare_fetcher(self):
        """æµ‹è¯•åˆ›å»º Akshare è·å–å™¨"""
        fetcher = DataFetcherFactory.create_fetcher('akshare')
        self.assertIsInstance(fetcher, AkshareDataFetcher)
    
    def test_create_tushare_fetcher(self):
        """æµ‹è¯•åˆ›å»º Tushare è·å–å™¨"""
        config = {'tushare_token': 'test_token'}
        fetcher = DataFetcherFactory.create_fetcher('tushare', config)
        self.assertIsInstance(fetcher, TushareDataFetcher)
    
    def test_create_with_fallback(self):
        """æµ‹è¯•é™çº§åˆ›å»º"""
        config = {'tushare_token': 'test_token'}
        fetcher = DataFetcherFactory.create_with_fallback('invalid', 'akshare', config)
        self.assertIsInstance(fetcher, AkshareDataFetcher)

class TestSmartSwitch(unittest.TestCase):
    """æµ‹è¯•æ™ºèƒ½åˆ‡æ¢"""
    
    def setUp(self):
        self.primary = AkshareDataFetcher()
        self.backup = TushareDataFetcher("test_token")
        self.smart_fetcher = SmartDataFetcher(self.primary, self.backup)
    
    def test_initial_fetcher(self):
        """æµ‹è¯•åˆå§‹ä½¿ç”¨ä¸»æ•°æ®æº"""
        self.assertEqual(self.smart_fetcher.current_fetcher, self.primary)
    
    def test_switch_on_failure(self):
        """æµ‹è¯•å¤±è´¥ååˆ‡æ¢"""
        # æ¨¡æ‹Ÿè¿ç»­å¤±è´¥
        for _ in range(3):
            try:
                self.smart_fetcher.get_stock_data('invalid_code', '2024-01-01')
            except:
                pass
        
        # éªŒè¯æ˜¯å¦åˆ‡æ¢åˆ°å¤‡ç”¨æ•°æ®æº
        self.assertEqual(self.smart_fetcher.current_fetcher, self.backup)

if __name__ == '__main__':
    unittest.main()
```

#### 5.2 é›†æˆæµ‹è¯•

åˆ›å»º `tests/test_backtest_integration.py`ï¼š

```python
import unittest
from backtest.backtest_engine import BacktestEngine
from config.csv_config_loader import create_csv_config

class TestBacktestIntegration(unittest.TestCase):
    """é›†æˆæµ‹è¯•ï¼šå®Œæ•´å›æµ‹æµç¨‹"""
    
    def test_backtest_with_akshare(self):
        """ä½¿ç”¨ Akshare è¿è¡Œå®Œæ•´å›æµ‹"""
        config = create_csv_config()
        config['data_source'] = 'akshare'
        
        engine = BacktestEngine(config)
        success = engine.run_backtest()
        
        self.assertTrue(success)
        self.assertIsNotNone(engine.get_backtest_results())
    
    def test_backtest_with_tushare(self):
        """ä½¿ç”¨ Tushare è¿è¡Œå®Œæ•´å›æµ‹"""
        config = create_csv_config()
        config['data_source'] = 'tushare'
        config['tushare_token'] = 'YOUR_TEST_TOKEN'
        
        engine = BacktestEngine(config)
        success = engine.run_backtest()
        
        self.assertTrue(success)
        self.assertIsNotNone(engine.get_backtest_results())
    
    def test_results_consistency(self):
        """éªŒè¯ä¸¤ç§æ•°æ®æºå›æµ‹ç»“æœä¸€è‡´æ€§"""
        # ä½¿ç”¨ç›¸åŒé…ç½®è¿è¡Œä¸¤æ¬¡å›æµ‹
        base_config = create_csv_config()
        
        # Akshare å›æµ‹
        config_ak = base_config.copy()
        config_ak['data_source'] = 'akshare'
        engine_ak = BacktestEngine(config_ak)
        engine_ak.run_backtest()
        results_ak = engine_ak.get_backtest_results()
        
        # Tushare å›æµ‹
        config_ts = base_config.copy()
        config_ts['data_source'] = 'tushare'
        config_ts['tushare_token'] = 'YOUR_TEST_TOKEN'
        engine_ts = BacktestEngine(config_ts)
        engine_ts.run_backtest()
        results_ts = engine_ts.get_backtest_results()
        
        # éªŒè¯å…³é”®æŒ‡æ ‡ä¸€è‡´æ€§ï¼ˆå…è®¸å°è¯¯å·®ï¼‰
        self.assertAlmostEqual(
            results_ak['total_return'], 
            results_ts['total_return'], 
            places=2
        )

if __name__ == '__main__':
    unittest.main()
```

#### 5.3 å›å½’æµ‹è¯•æ¸…å•

**åŠŸèƒ½å›å½’æµ‹è¯•**ï¼š
- [ ] ç°æœ‰å›æµ‹ç»“æœå¯å¤ç°ï¼ˆä½¿ç”¨ Akshareï¼‰
- [ ] ç¼“å­˜æœºåˆ¶æ­£å¸¸å·¥ä½œ
- [ ] åˆ†çº¢é…è‚¡æ•°æ®æ­£ç¡®å¯¹é½
- [ ] æŠ€æœ¯æŒ‡æ ‡è®¡ç®—ä¸€è‡´
- [ ] 4ç»´ä¿¡å·ç”Ÿæˆæ­£ç¡®
- [ ] åŠ¨æ€ä»“ä½ç®¡ç†æ­£å¸¸
- [ ] HTML æŠ¥å‘Šç”Ÿæˆæ­£å¸¸
- [ ] CSV æŠ¥å‘Šç”Ÿæˆæ­£å¸¸
- [ ] æ€§èƒ½åˆ†æå™¨æ­£å¸¸å·¥ä½œ

**æ•°æ®æºåˆ‡æ¢æµ‹è¯•**ï¼š
- [ ] Akshare å•ç‹¬ä½¿ç”¨æ­£å¸¸
- [ ] Tushare å•ç‹¬ä½¿ç”¨æ­£å¸¸
- [ ] æ™ºèƒ½åˆ‡æ¢æ¨¡å¼æ­£å¸¸
- [ ] é™çº§æ¨¡å¼æ­£å¸¸
- [ ] é…ç½®æ–‡ä»¶è¯»å–æ­£ç¡®
- [ ] æ—¥å¿—è¾“å‡ºæ¸…æ™°

**æ€§èƒ½æµ‹è¯•**ï¼š
- [ ] Akshare æ•°æ®è·å–é€Ÿåº¦
- [ ] Tushare æ•°æ®è·å–é€Ÿåº¦
- [ ] ç¼“å­˜å‘½ä¸­ç‡
- [ ] å†…å­˜ä½¿ç”¨æƒ…å†µ
- [ ] å®Œæ•´å›æµ‹è€—æ—¶

#### 5.4 è¾¹ç•Œæµ‹è¯•

**é”™è¯¯å¤„ç†æµ‹è¯•**ï¼š
- [ ] Token æ— æ•ˆæ—¶çš„é”™è¯¯æç¤º
- [ ] ç½‘ç»œè¿æ¥å¤±è´¥æ—¶çš„é‡è¯•æœºåˆ¶
- [ ] é¢‘ç‡é™åˆ¶è§¦å‘æ—¶çš„ç­‰å¾…
- [ ] æ•°æ®ç¼ºå¤±æ—¶çš„å®¹é”™
- [ ] è‚¡ç¥¨ä»£ç é”™è¯¯æ—¶çš„æç¤º
- [ ] æ—¥æœŸæ ¼å¼é”™è¯¯æ—¶çš„æç¤º

**æç«¯åœºæ™¯æµ‹è¯•**ï¼š
- [ ] å¤§é‡è‚¡ç¥¨ï¼ˆ50+ï¼‰å›æµ‹
- [ ] é•¿æ—¶é—´è·¨åº¦ï¼ˆ5å¹´+ï¼‰å›æµ‹
- [ ] é¢‘ç¹åˆ‡æ¢æ•°æ®æº
- [ ] ä¸»å¤‡æ•°æ®æºéƒ½å¤±è´¥çš„æƒ…å†µ

#### 5.5 æµ‹è¯•æŠ¥å‘Šæ¨¡æ¿

```markdown
# æ•°æ®æºåˆ‡æ¢åŠŸèƒ½æµ‹è¯•æŠ¥å‘Š

## æµ‹è¯•ç¯å¢ƒ
- Python ç‰ˆæœ¬ï¼š3.13
- æ“ä½œç³»ç»Ÿï¼šmacOS
- æµ‹è¯•æ—¥æœŸï¼š2025-12-12

## æµ‹è¯•ç»“æœæ±‡æ€»

| æµ‹è¯•ç±»åˆ« | æµ‹è¯•ç”¨ä¾‹æ•° | é€šè¿‡ | å¤±è´¥ | é€šè¿‡ç‡ |
|---------|-----------|------|------|--------|
| å•å…ƒæµ‹è¯• | 15 | 15 | 0 | 100% |
| é›†æˆæµ‹è¯• | 5 | 5 | 0 | 100% |
| å›å½’æµ‹è¯• | 12 | 12 | 0 | 100% |
| è¾¹ç•Œæµ‹è¯• | 8 | 8 | 0 | 100% |
| **æ€»è®¡** | **40** | **40** | **0** | **100%** |

## è¯¦ç»†æµ‹è¯•ç»“æœ

### 1. å•å…ƒæµ‹è¯•
âœ… æ‰€æœ‰å•å…ƒæµ‹è¯•é€šè¿‡

### 2. é›†æˆæµ‹è¯•
âœ… Akshare å®Œæ•´å›æµ‹é€šè¿‡
âœ… Tushare å®Œæ•´å›æµ‹é€šè¿‡
âœ… ç»“æœä¸€è‡´æ€§éªŒè¯é€šè¿‡

### 3. æ€§èƒ½å¯¹æ¯”

| æŒ‡æ ‡ | Akshare | Tushare | å·®å¼‚ |
|------|---------|---------|------|
| æ•°æ®è·å–é€Ÿåº¦ | 2.5s/è‚¡ | 1.8s/è‚¡ | Tushare å¿« 28% |
| å®Œæ•´å›æµ‹è€—æ—¶ | 45s | 38s | Tushare å¿« 16% |
| å†…å­˜ä½¿ç”¨ | 250MB | 245MB | ç›¸å½“ |

### 4. å‘ç°çš„é—®é¢˜
æ— 

### 5. å»ºè®®
- âœ… åŠŸèƒ½å®Œæ•´ï¼Œå¯ä»¥å‘å¸ƒ
- å»ºè®®åœ¨ç”Ÿäº§ç¯å¢ƒä½¿ç”¨ Tushare ä½œä¸ºä¸»æ•°æ®æº
- å»ºè®®å¯ç”¨æ™ºèƒ½åˆ‡æ¢æ¨¡å¼ä»¥æé«˜ç¨³å®šæ€§
```

#### 5.6 äº¤ä»˜ç‰©
- âœ… å®Œæ•´çš„å•å…ƒæµ‹è¯•å¥—ä»¶
- âœ… å®Œæ•´çš„é›†æˆæµ‹è¯•å¥—ä»¶
- âœ… å›å½’æµ‹è¯•æ¸…å•ï¼ˆå…¨éƒ¨é€šè¿‡ï¼‰
- âœ… è¾¹ç•Œæµ‹è¯•æ¸…å•ï¼ˆå…¨éƒ¨é€šè¿‡ï¼‰
- âœ… æµ‹è¯•æŠ¥å‘Š
- âœ… æ€§èƒ½å¯¹æ¯”æŠ¥å‘Š

---

## ğŸ“Š å®æ–½æ—¶é—´çº¿

| é˜¶æ®µ | ä»»åŠ¡ | é¢„è®¡æ—¶é—´ | ä¾èµ–å…³ç³» | çŠ¶æ€ |
|------|------|---------|---------|------|
| é˜¶æ®µ1 | TushareDataFetcher å®ç° | 2-3å°æ—¶ | æ—  | â³ å¾…å¼€å§‹ |
| é˜¶æ®µ2 | å·¥å‚æ¨¡å¼å®ç° | 1-2å°æ—¶ | é˜¶æ®µ1 | â³ å¾…å¼€å§‹ |
| é˜¶æ®µ3 | BacktestEngine é›†æˆ | 2-3å°æ—¶ | é˜¶æ®µ2 | â³ å¾…å¼€å§‹ |
| é˜¶æ®µ4 | é…ç½®å’Œæ–‡æ¡£æ›´æ–° | 1å°æ—¶ | é˜¶æ®µ3 | â³ å¾…å¼€å§‹ |
| é˜¶æ®µ5 | æµ‹è¯•éªŒè¯ | 2-3å°æ—¶ | é˜¶æ®µ4 | â³ å¾…å¼€å§‹ |
| **æ€»è®¡** | - | **8-12å°æ—¶** | - | - |

---

## ğŸ é¢„æœŸæ”¶ç›Š

å®Œæˆæ­¤å¼€å‘åï¼Œç³»ç»Ÿå°†è·å¾—ï¼š

### 1. ç¨³å®šæ€§æå‡
- âœ… åŒæ•°æ®æºä¿éšœï¼Œé¿å…å•ç‚¹æ•…éšœ
- âœ… æ™ºèƒ½åˆ‡æ¢æœºåˆ¶ï¼Œè‡ªåŠ¨åº”å¯¹ç½‘ç»œé—®é¢˜
- âœ… é™çº§ç­–ç•¥ï¼Œç¡®ä¿ç³»ç»ŸæŒç»­å¯ç”¨

### 2. å¯ç»´æŠ¤æ€§æå‡
- âœ… æ¸…æ™°çš„æ¶æ„è®¾è®¡ï¼ˆå·¥å‚æ¨¡å¼ï¼‰
- âœ… å®Œæ•´çš„æ–‡æ¡£å’Œä½¿ç”¨æŒ‡å—
- âœ… æ ‡å‡†åŒ–çš„æ•°æ®æ ¼å¼

### 3. æ‰©å±•æ€§æå‡
- âœ… æ˜“äºæ·»åŠ æ–°æ•°æ®æºï¼ˆå¦‚ä¸œæ–¹è´¢å¯Œã€åŒèŠ±é¡ºç­‰ï¼‰
- âœ… çµæ´»çš„é…ç½®ç³»ç»Ÿ
- âœ… æ¨¡å—åŒ–è®¾è®¡

### 4. ç”¨æˆ·ä½“éªŒæå‡
- âœ… ç®€å•çš„é…ç½®æ–¹å¼
- âœ… æ¸…æ™°çš„æ—¥å¿—è¾“å‡º
- âœ… æ™ºèƒ½çš„é”™è¯¯å¤„ç†

---

## ğŸš€ å®æ–½å»ºè®®

### å®æ–½é¡ºåº
å»ºè®®ä¸¥æ ¼æŒ‰ç…§é˜¶æ®µ1â†’2â†’3â†’4â†’5çš„é¡ºåºå®æ–½ï¼Œæ¯ä¸ªé˜¶æ®µå®Œæˆåè¿›è¡ŒéªŒè¯å†è¿›å…¥ä¸‹ä¸€é˜¶æ®µã€‚

### é£é™©æ§åˆ¶
1. **ä»£ç å¤‡ä»½**ï¼šå®æ–½å‰å®Œæ•´å¤‡ä»½ç°æœ‰ä»£ç 
2. **åˆ†æ”¯å¼€å‘**ï¼šåœ¨ç‹¬ç«‹åˆ†æ”¯ä¸Šå¼€å‘ï¼Œæµ‹è¯•é€šè¿‡åå†åˆå¹¶
3. **æ¸è¿›å¼éƒ¨ç½²**ï¼šå…ˆåœ¨æµ‹è¯•ç¯å¢ƒéªŒè¯ï¼Œå†éƒ¨ç½²åˆ°ç”Ÿäº§ç¯å¢ƒ

### è´¨é‡ä¿è¯
1. **ä»£ç å®¡æŸ¥**ï¼šæ¯ä¸ªé˜¶æ®µå®Œæˆåè¿›è¡Œä»£ç å®¡æŸ¥
2. **æµ‹è¯•è¦†ç›–**ï¼šç¡®ä¿æµ‹è¯•è¦†ç›–ç‡ > 80%
3. **æ–‡æ¡£åŒæ­¥**ï¼šä»£ç å’Œæ–‡æ¡£åŒæ­¥æ›´æ–°

---

## ğŸ“ é™„å½•

### A. Tushare æ³¨å†ŒæŒ‡å—
1. è®¿é—®ï¼šhttps://tushare.pro/register
2. å¡«å†™é‚®ç®±å’Œå¯†ç 
3. é‚®ç®±éªŒè¯
4. ç™»å½•åè®¿é—®ï¼šhttps://tushare.pro/user/token
5. å¤åˆ¶ Token

### B. ç¯å¢ƒå˜é‡é…ç½®
```bash
# macOS/Linux
export TUSHARE_TOKEN="your_token_here"

# Windows
set TUSHARE_TOKEN=your_token_here

# æ°¸ä¹…é…ç½®ï¼ˆmacOS/Linuxï¼‰
echo 'export TUSHARE_TOKEN="your_token_here"' >> ~/.zshrc
source ~/.zshrc
```

### C. å¸¸ç”¨å‘½ä»¤
```bash
# è¿è¡Œå•å…ƒæµ‹è¯•
python3 -m pytest tests/test_data_fetcher.py -v

# è¿è¡Œé›†æˆæµ‹è¯•
python3 -m pytest tests/test_backtest_integration.py -v

# è¿è¡Œæ‰€æœ‰æµ‹è¯•
python3 -m pytest tests/ -v

# ç”Ÿæˆæµ‹è¯•è¦†ç›–ç‡æŠ¥å‘Š
python3 -m pytest tests/ --cov=data --cov=backtest --cov-report=html
```

### D. å‚è€ƒèµ„æ–™
- Tushare å®˜æ–¹æ–‡æ¡£ï¼šhttps://tushare.pro/document/2
- Akshare å®˜æ–¹æ–‡æ¡£ï¼šhttps://akshare.akfamily.xyz/
- Python å·¥å‚æ¨¡å¼ï¼šhttps://refactoring.guru/design-patterns/factory-method/python/example

---

**æ–‡æ¡£ç‰ˆæœ¬**: 1.0  
**æœ€åæ›´æ–°**: 2025-12-12  
**ç»´æŠ¤è€…**: å¼€å‘å›¢é˜Ÿ
