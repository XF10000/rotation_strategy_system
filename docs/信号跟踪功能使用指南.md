# 信号跟踪功能使用指南

**版本**: V1.0  
**日期**: 2025-08-28  
**功能**: 4维买卖信号详细跟踪和记录

---

## 🎯 功能概述

信号跟踪功能是对中线轮动策略系统的重要增强，专门用于记录和分析4维信号分析框架生成的买卖信号。

### 核心特性
- ✅ **只记录BUY/SELL信号**：跳过HOLD信号，专注于实际交易机会
- ✅ **高质量信号筛选**：只记录通过4维确认的高质量买卖信号
- ✅ **32字段详细记录**：包含完整的技术指标和决策依据
- ✅ **自动集成到回测**：无需额外配置，回测时自动生成报告

---

## 🚀 基本使用

### 自动使用（推荐）
正常运行回测即可自动生成信号跟踪报告：

```bash
python3 main.py
```

### 手动使用
```python
from backtest.signal_tracker import SignalTracker

# 创建信号跟踪器
tracker = SignalTracker("reports/my_signal_report.csv")

# 记录信号（在回测循环中）
tracker.record_signal({
    'date': current_date,
    'stock_code': '601088',
    'signal_result': signal_result
})

# 导出报告
report_path = tracker.export_to_csv()
print(f"信号跟踪报告已生成: {report_path}")
```

---

## 📊 输出文件

### 文件位置
- **自动生成**: `reports/signal_tracking_report_YYYYMMDD_HHMMSS.csv`
- **手动指定**: 用户自定义路径

### 文件格式
- **编码**: UTF-8-BOM（确保Excel正确显示中文）
- **分隔符**: 逗号（,）
- **表头**: 中文字段名称

---

## 📋 记录字段说明

### 🏷️ 基础信息 (5个字段)
| 字段名 | 说明 | 示例 |
|--------|------|------|
| 日期 | 信号生成日期 | 2025-08-28 |
| 股票代码 | 股票代码 | 601088 |
| 股票名称 | 股票名称 | 中国神华 |
| 信号类型 | BUY/SELL | BUY |
| 当前价格 | 信号生成时的价格(元) | 25.68 |

### ⚖️ 4维信号综合决策 (5个字段)
| 字段名 | 说明 | 示例 |
|--------|------|------|
| 维度一状态 | 价值准入过滤器状态 | 满足 |
| 技术维度满足数量 | 维度二三四中满足的数量 | 2 |
| 三者取二结果 | 是否满足至少2个技术维度 | 是 |
| 信号强度 | 综合信号强度评分(0-100) | 80 |
| 最终决策依据 | 具体的决策逻辑描述 | 价值过滤器满足，技术维度满足2/3个 |

### 💰 维度一：价值准入过滤器 (3个字段)
| 字段名 | 说明 | 示例 |
|--------|------|------|
| DCF估值 | 每股DCF估值(元) | 40.00 |
| 价值比率 | 当前价格/DCF估值 | 0.6420 |
| 价值过滤器状态 | 通过/未通过 | 通过 |

### 📈 维度二：超买超卖 (9个字段)
| 字段名 | 说明 | 示例 |
|--------|------|------|
| 申万二级行业 | 股票所属行业 | 煤炭开采 |
| 14周RSI | 当前RSI值 | 28.45 |
| 行业买入阈值 | 该行业普通买入阈值 | 34.31 |
| 行业卖出阈值 | 该行业普通卖出阈值 | 69.30 |
| 行业极端买入阈值 | 该行业极端买入阈值 | 24.15 |
| 行业极端卖出阈值 | 该行业极端卖出阈值 | 79.46 |
| RSI信号类型 | 普通信号/极端信号/无信号 | 普通信号 |
| 价格背离状态 | 无背离/顶背离/底背离 | 出现底背离 |
| 维度二信号状态 | 买入/卖出/无信号 | 买入 |

### 🚀 维度三：动能确认 (7个字段)
| 字段名 | 说明 | 示例 |
|--------|------|------|
| MACD DIF值 | 快线值 | -0.1234 |
| MACD DEA值 | 慢线值 | -0.2345 |
| MACD柱体值 | 当前柱体值 | 0.1111 |
| MACD柱体颜色 | 红色/绿色 | 红色 |
| 柱体连续变化 | 连续缩短/放大 | 连续缩短 |
| 金叉死叉状态 | DIF金叉DEA/死叉DEA/无交叉 | DIF金叉DEA |
| 维度三信号状态 | 买入/卖出/无信号 | 买入 |

### 📊 维度四：极端放量 (9个字段)
| 字段名 | 说明 | 示例 |
|--------|------|------|
| 布林带中轨值 | 20周均线值 | 26.78 |
| 布林带上轨值 | 上轨数值 | 28.95 |
| 布林带下轨值 | 下轨数值 | 24.61 |
| 价格布林带位置 | 突破上轨/跌破下轨/区间内 | 跌破下轨 |
| 当前成交量 | 本周成交量 | 1234567 |
| 历史成交量基准 | 用于比较的基准成交量 | 987654 |
| 成交量放大倍数 | 当前量/基准量 | 1.25 |
| 是否显著放量 | 是/否 | 是 |
| 维度四信号状态 | 买入/卖出/无信号 | 买入 |

### 🔍 技术指标原始数据 (4个字段)
| 字段名 | 说明 | 示例 |
|--------|------|------|
| 最近5周收盘价 | 价格序列 | [25.1, 25.3, 25.0, 25.5, 25.68] |
| 最近5周成交量 | 成交量序列 | [1000000, 1100000, 950000, 1200000, 1234567] |
| 数据质量状态 | 数据长度 | 数据长度125条 |
| 计算异常信息 | 异常说明 | 无 |

---

## 🔧 信号质量筛选

### 筛选标准
只有同时满足以下条件的信号才会被记录：

1. **信号类型**: 必须是BUY或SELL（跳过HOLD）
2. **价值过滤器**: 必须通过价值准入过滤器（硬性前提）
3. **技术维度**: 在超买超卖、动能确认、极端放量三个维度中至少满足2个

### 信号强度计算
```
信号强度 = 价值过滤器(40分) + 超买超卖(20分) + 动能确认(20分) + 极端放量(20分)
```

---

## 📈 数据分析建议

### Excel分析
1. **按股票分组**: 分析不同股票的信号频率
2. **按时间分析**: 观察信号的时间分布规律
3. **信号强度统计**: 分析高强度信号的成功率
4. **维度贡献分析**: 识别最重要的技术维度

### Python分析示例
```python
import pandas as pd

# 读取信号跟踪报告
df = pd.read_csv('reports/signal_tracking_report_20250828_143022.csv')

# 信号统计
print("信号类型分布:")
print(df['信号类型'].value_counts())

# 信号强度分析
print("平均信号强度:")
print(df.groupby('信号类型')['信号强度'].mean())

# 股票信号频率
print("各股票信号频率:")
print(df['股票名称'].value_counts())

# 维度满足分析
print("技术维度满足情况:")
print(df['技术维度满足数量'].value_counts())
```

---

## ⚠️ 注意事项

### 性能影响
- 信号跟踪功能对回测性能影响极小（< 1%）
- 大量信号记录时，CSV文件可能较大
- 建议定期清理历史报告文件

### 数据准确性
- 记录的技术指标值与实际交易决策时完全一致
- 所有数据来源于SignalGenerator的实时计算
- 行业阈值基于最新的申万二级行业分类

### 文件管理
- 每次回测会生成新的报告文件（带时间戳）
- 可通过文件名时间戳追溯具体回测
- 建议定期备份重要的信号跟踪报告

---

## 🛠️ 故障排除

### 常见问题

#### 1. 没有生成信号跟踪报告
**原因**: 回测期间没有生成BUY/SELL信号
**解决**: 检查回测配置和股票池设置

#### 2. 报告为空或信号很少
**原因**: 4维信号筛选条件严格，只记录高质量信号
**解决**: 正常现象，说明信号质量控制有效

#### 3. 某些字段显示默认值
**原因**: SignalGenerator尚未完全实现所有详细信息收集
**解决**: 功能逐步完善中，核心信息已可用

#### 4. CSV文件在Excel中乱码
**原因**: 编码问题
**解决**: 使用UTF-8-BOM编码，或用记事本另存为UTF-8

---

## 📞 技术支持

如有问题，请检查：
1. 回测日志中的信号跟踪相关信息
2. output目录的文件权限
3. 系统可用磁盘空间

---

**文档维护**: 本文档随功能迭代持续更新，确保使用说明与实际功能保持一致。