# 版本更新记录

## 📋 版本历史

### V4.2 (2025-08-23) - 技术指标标准化版 🔧

#### 🆕 重大更新：技术指标标准化
**解决的核心问题**：TA-Lib技术指标计算的历史窗口敏感性

#### 🎯 核心改进
- **信号一致性保证**: 解决不同回测起始日期产生不同信号的问题
- **RSI稳定性提升**: 差异从2.2降低到0.04，减少98%
- **分层计算策略**: 120条优先→60条回退→全量数据兜底
- **配置参数优化**: 历史数据从40周增加到125周

#### 🛠️ 技术实现
**分层标准化策略**:
- 数据≥120条：使用120条标准长度（最佳稳定性）
- 数据60-119条：使用60条最低稳定长度（基本稳定性）
- 数据<60条：使用全部数据+警告（兜底机制）

**配置调整**:
- min_data_length: 40条 → 120条
- 回测历史数据: 40周 → 125周
- 信号生成检查: 120条 → 60条

#### 📊 修复效果验证
**淮北矿业(600985) 2025-04-25测试**:
- 长期回测(2021开始): RSI = 34.5664
- 短期回测(2025开始): RSI = 34.5218
- **改进效果**: RSI差异从2.2降低到0.04，减少98%

#### ✅ 技术优势
1. 消除技术指标计算的随机性
2. 提高策略回测结果的可靠性
3. 增强交易信号的稳定性
4. 保持系统的向后兼容性

### V4.0 (2025-08-11) - 动态仓位管理系统 💰

#### 🆕 新增功能
- **基于价值比的动态仓位管理系统**
- **估值驱动的买卖决策逻辑**
- **完善的风险控制机制**
- **分红配股事件处理和记录**

#### 📈 仓位策略
**买入仓位策略**（基于价值比：当前价格/DCF估值）:
- 极度低估(≤60%): 加仓50%当前持仓或40%可用现金
- 明显低估(60%-70%): 加仓20%当前持仓或20%可用现金
- 轻度低估(70%-80%): 加仓10%当前持仓或10%可用现金

**卖出仓位策略**:
- 极度高估(>120%): 减仓100%（全部卖出）
- 轻度高估(100%-120%): 减仓80%
- 合理区间(80%-100%): 减仓50%

#### 🔧 风险控制
- 最小交易单位: 100股整数倍
- 最小交易金额: 10,000元
- 现金安全垫: 保持至少5%总资产
- 单股持仓上限: 不超过25%总资产

### V3.1 (2025-08-22) - 季度自动更新版 ⚙️

#### 🚀 性能优化
- **季度自动更新**: 行业映射文件和RSI阈值文件每季度自动更新
- **启动速度优化**: 从数分钟网络查询优化到秒级启动
- **本地缓存机制**: 5,209只股票的申万二级行业映射本地缓存
- **动态RSI阈值**: 124个申万二级行业个性化阈值

#### 🔄 自动更新机制
**触发条件**:
- 文件不存在
- 跨季度运行
- 文件超过4个月
- 数据量异常

**更新内容**:
- 124个申万二级行业映射
- 5,209只股票行业分类
- 动态RSI超买超卖阈值

### V3.0 (2025-08-05) - 渐进式买卖逻辑 📈

#### 💡 核心理念
采用渐进式买卖策略，每次交易固定20%比例，避免一次性大额交易。

#### 🔄 买卖逻辑
**买入执行**:
- 无持仓时: 买入现金的20%
- 有持仓时: 买入当前持仓市值的20%（加仓）

**卖出执行**:
- 无持仓时: 忽略卖出信号
- 有持仓时: 卖出当前持仓市值的20%（减仓）

#### 🛡️ 风险控制
- 最小交易单位: 100股整数倍（A股规则）
- 现金不足保护: 确保资金充足
- 持仓检查: 卖出不超过实际持仓

### V2.2 (2025-08-05) - CSV配置管理版 📋

#### ⚙️ CSV配置系统
- **投资组合配置**: 股票池、权重、行业分类、DCF估值
- **回测设置配置**: 资金、日期、参数设置
- **行业RSI阈值配置**: 个性化超买超卖阈值

#### 🔧 技术特性
- UTF-8-BOM编码，Excel完美兼容
- 权重总和验证机制
- 多种日期格式支持
- 智能配置验证和错误处理

### V2.0 (2025-07-27) - 增强版报告系统 📊

#### 📈 报告增强
- **详细CSV导出**: 28列完整交易数据
- **4维信号分析**: 完整的技术指标和信号状态
- **增强版可视化**: 交互式K线图和详细报告
- **真实基准对比**: 动态基准计算和超额收益分析

#### 📋 交易记录
**包含信息**:
- 基础交易信息（7列）
- 技术指标快照（13列）
- 4维信号分析（5列）
- 交易成本明细（3列）

### V1.0 (2024-12) - 基础版本 🎯

#### 🏗️ 基础功能
- 4维信号分析框架
- 基本回测功能
- 简单信号生成
- 基础报告输出

#### 📁 模块架构
- 数据获取和处理
- 策略信号生成
- 投资组合管理
- 基础性能分析

## 🔄 升级建议

### 对于现有用户
1. **立即升级到v4.2**: 解决关键的技术计算问题
2. **重新运行回测**: 使用新版本验证策略表现
3. **检查配置参数**: 确认历史数据长度已更新到125周

### 对于新用户
1. **直接使用v4.2**: 享受最稳定的技术指标计算
2. **准备充足数据**: 确保至少125周历史数据
3. **参考完整文档**: 查看技术说明和使用指南

## 📝 版本兼容性

- **向后兼容**: 新版本完全兼容现有配置文件
- **配置自动升级**: 系统自动检测并升级参数
- **数据格式一致**: 输出格式保持兼容，无需修改分析脚本

## 🔮 后续规划

1. **算法优化**: 继续优化技术指标计算性能
2. **策略扩展**: 增加更多交易策略选择
3. **用户体验**: 基于反馈持续改进系统易用性

---

**维护说明**: 
- 文档创建: 2025年8月23日
- 维护频率: 随版本发布同步更新
- 责任团队: 开发团队