# 中线轮动策略系统 - 配置说明文档

## 📋 文档概述

**文档版本：** v1.0  
**创建日期：** 2026-01-16  
**目标读者：** 系统使用者、开发工程师  
**阅读时间：** 约15-20分钟

本文档详细说明系统的配置方式、配置项含义和最佳实践。

---

## 🎯 配置系统概述

### 配置文件结构

```
Rotation_Strategy_3_1/
├── Input/                          # 主要配置目录
│   ├── portfolio_config.csv        # 股票池配置 ⭐
│   ├── Backtest_settings.csv       # 回测参数配置 ⭐
│   └── sw2_rsi_threshold.csv       # RSI阈值配置
│
├── config/                         # 系统配置目录
│   ├── settings.py                 # 基础配置
│   └── backtest_report_template.html  # 报告模板
│
└── sw_rsi_thresholds/              # 行业阈值配置
    └── sw2_rsi_threshold.csv       # 申万二级行业阈值
```

### 配置优先级

```
1. CSV配置文件 (Input/)           ← 最高优先级，用户可修改
   ↓
2. 系统配置 (config/settings.py)  ← 默认配置
   ↓
3. 代码硬编码                      ← 最低优先级，不推荐
```

---

## 📊 股票池配置 (portfolio_config.csv)

### 文件位置
`Input/portfolio_config.csv`

### 文件格式

```csv
股票代码,股票名称,初始权重,行业分类,DCF估值,申万二级行业代码,申万二级行业名称
601088,中国神华,0.33,煤炭开采,25.5,220201,煤炭开采
601225,淮北矿业,0.33,煤炭开采,18.2,220201,煤炭开采
600985,淮矿控股,0.34,煤炭开采,15.8,220201,煤炭开采
```

### 配置项说明

| 列名 | 类型 | 必填 | 说明 | 示例 |
|------|------|------|------|------|
| 股票代码 | 字符串 | ✅ | 6位股票代码 | 601088 |
| 股票名称 | 字符串 | ✅ | 股票中文名称 | 中国神华 |
| 初始权重 | 浮点数 | ✅ | 初始持仓权重（总和应为1.0） | 0.33 |
| 行业分类 | 字符串 | ❌ | 行业分类（用于分析） | 煤炭开采 |
| DCF估值 | 浮点数 | ⭐ | DCF估值价格（用于价值比过滤器） | 25.5 |
| 申万二级行业代码 | 字符串 | ⭐ | 申万二级行业代码（用于RSI阈值） | 220201 |
| 申万二级行业名称 | 字符串 | ❌ | 申万二级行业名称 | 煤炭开采 |

**⭐ 重要字段：**
- **DCF估值** - 影响价值比过滤器（硬性前提）
- **申万二级行业代码** - 决定使用哪套RSI阈值

### 配置示例

**示例1：煤炭股组合**
```csv
股票代码,股票名称,初始权重,行业分类,DCF估值,申万二级行业代码,申万二级行业名称
601088,中国神华,0.33,煤炭开采,25.5,220201,煤炭开采
601225,淮北矿业,0.33,煤炭开采,18.2,220201,煤炭开采
600985,淮矿控股,0.34,煤炭开采,15.8,220201,煤炭开采
```

**示例2：银行股组合**
```csv
股票代码,股票名称,初始权重,行业分类,DCF估值,申万二级行业代码,申万二级行业名称
601398,工商银行,0.33,银行,6.5,480201,银行
601939,建设银行,0.33,银行,7.2,480201,银行
601288,农业银行,0.34,银行,4.8,480201,银行
```

**示例3：混合行业组合**
```csv
股票代码,股票名称,初始权重,行业分类,DCF估值,申万二级行业代码,申万二级行业名称
601088,中国神华,0.25,煤炭开采,25.5,220201,煤炭开采
601398,工商银行,0.25,银行,6.5,480201,银行
600519,贵州茅台,0.25,白酒,2100.0,320301,白酒
000858,五粮液,0.25,白酒,180.0,320301,白酒
```

### 配置注意事项

1. **权重总和**
   - 所有股票的初始权重总和应该等于1.0
   - 系统会自动标准化，但建议手动确保正确

2. **DCF估值**
   - DCF估值是价值比过滤器的关键参数
   - 建议定期更新（每季度）
   - 如果没有DCF估值，系统会回退到EMA趋势过滤器

3. **行业代码**
   - 必须使用申万二级行业代码
   - 代码必须在 `sw2_rsi_threshold.csv` 中存在
   - 否则会使用默认RSI阈值（70/30）

4. **股票代码格式**
   - 必须是6位数字
   - 不需要加市场后缀（.SH/.SZ）

---

## ⚙️ 回测参数配置 (Backtest_settings.csv)

### 文件位置
`Input/Backtest_settings.csv`

### 文件格式

```csv
参数名称,参数值
回测开始日期,2021-01-08
回测结束日期,2025-01-03
总资本,14999341
价值比卖出阈值,0.8
价值比买入阈值,0.7
动态仓位启用,True
最小仓位比例,0.05
最大仓位比例,0.15
```

### 配置项详解

#### 基础参数

| 参数名称 | 类型 | 默认值 | 说明 |
|---------|------|--------|------|
| 回测开始日期 | 日期 | 2021-01-08 | 回测起始日期（YYYY-MM-DD） |
| 回测结束日期 | 日期 | 2025-01-03 | 回测结束日期（YYYY-MM-DD） |
| 总资本 | 整数 | 14999341 | 初始总资金（元） |

**说明：**
- 日期格式必须为 `YYYY-MM-DD`
- 回测周期建议至少1年，以获得有效的统计结果
- 总资本会按照股票池权重分配

#### 价值比过滤器参数

| 参数名称 | 类型 | 默认值 | 说明 |
|---------|------|--------|------|
| 价值比卖出阈值 | 浮点数 | 0.8 | 当价格/DCF > 80%时考虑卖出 |
| 价值比买入阈值 | 浮点数 | 0.7 | 当价格/DCF < 70%时考虑买入 |

**说明：**
- 价值比 = 当前价格 / DCF估值
- 卖出阈值应该 > 买入阈值
- 典型范围：买入 0.6-0.8，卖出 0.8-1.0

**示例：**
```
DCF估值 = 100元
当前价格 = 75元
价值比 = 75/100 = 0.75

如果买入阈值 = 0.7，卖出阈值 = 0.8：
- 价格 < 70元 → 考虑买入
- 价格 > 80元 → 考虑卖出
- 70元 ≤ 价格 ≤ 80元 → 持有
```

#### 动态仓位管理参数

| 参数名称 | 类型 | 默认值 | 说明 |
|---------|------|--------|------|
| 动态仓位启用 | 布尔 | True | 是否启用动态仓位管理 |
| 最小仓位比例 | 浮点数 | 0.05 | 单只股票最小仓位（5%） |
| 最大仓位比例 | 浮点数 | 0.15 | 单只股票最大仓位（15%） |

**说明：**
- 动态仓位根据信号强度调整买入数量
- 最小/最大仓位限制风险暴露
- 如果禁用，使用固定权重

#### 交易成本参数

| 参数名称 | 类型 | 默认值 | 说明 |
|---------|------|--------|------|
| 手续费率 | 浮点数 | 0.0003 | 万3（买卖双向） |
| 印花税率 | 浮点数 | 0.001 | 千1（仅卖出） |
| 滑点率 | 浮点数 | 0.001 | 千1（买卖双向） |

**说明：**
- 手续费：买入和卖出都收取
- 印花税：只在卖出时收取
- 滑点：模拟实际成交价格偏差

**交易成本计算示例：**
```
买入10000元股票：
- 手续费：10000 × 0.0003 = 3元
- 滑点：10000 × 0.001 = 10元
- 总成本：10013元

卖出10000元股票：
- 手续费：10000 × 0.0003 = 3元
- 印花税：10000 × 0.001 = 10元
- 滑点：10000 × 0.001 = 10元
- 总成本：23元
- 实际到账：9977元
```

### 配置示例

**示例1：长期回测（4年）**
```csv
参数名称,参数值
回测开始日期,2021-01-01
回测结束日期,2025-01-01
总资本,10000000
价值比卖出阈值,0.8
价值比买入阈值,0.7
```

**示例2：短期回测（1年）**
```csv
参数名称,参数值
回测开始日期,2024-01-01
回测结束日期,2025-01-01
总资本,5000000
价值比卖出阈值,0.85
价值比买入阈值,0.65
```

**示例3：保守策略**
```csv
参数名称,参数值
回测开始日期,2021-01-01
回测结束日期,2025-01-01
总资本,10000000
价值比卖出阈值,0.75
价值比买入阈值,0.6
最小仓位比例,0.08
最大仓位比例,0.12
```

---

## 📈 RSI阈值配置 (sw2_rsi_threshold.csv)

### 文件位置
`Input/sw2_rsi_threshold.csv`

### 文件格式

```csv
申万二级行业代码,申万二级行业名称,RSI超买阈值,RSI超卖阈值,RSI极端超买阈值,RSI极端超卖阈值
220201,煤炭开采,65.234,32.156,72.891,25.443
480201,银行,68.123,28.567,75.234,22.891
320301,白酒,72.456,35.789,80.123,28.456
```

### 配置项说明

| 列名 | 类型 | 说明 |
|------|------|------|
| 申万二级行业代码 | 字符串 | 6位行业代码 |
| 申万二级行业名称 | 字符串 | 行业中文名称 |
| RSI超买阈值 | 浮点数 | 普通超买阈值（配合背离使用） |
| RSI超卖阈值 | 浮点数 | 普通超卖阈值（配合背离使用） |
| RSI极端超买阈值 | 浮点数 | 极端超买阈值（强制卖出信号） |
| RSI极端超卖阈值 | 浮点数 | 极端超卖阈值（强制买入信号） |

### RSI阈值逻辑

```
极端阈值（强制信号）
├── RSI ≥ 极端超买阈值 → 强制卖出信号
└── RSI ≤ 极端超卖阈值 → 强制买入信号

普通阈值（配合背离）
├── RSI > 超买阈值 + 顶背离 → 卖出信号
└── RSI < 超卖阈值 + 底背离 → 买入信号
```

### 行业特定阈值示例

**周期性行业（煤炭）：**
```csv
220201,煤炭开采,65.234,32.156,72.891,25.443
```
- 超买超卖区间较窄（周期性强）
- 极端阈值相对保守

**防御性行业（银行）：**
```csv
480201,银行,68.123,28.567,75.234,22.891
```
- 超买超卖区间较宽（波动较小）
- 极端阈值较高/较低

**成长性行业（白酒）：**
```csv
320301,白酒,72.456,35.789,80.123,28.456
```
- 超买阈值较高（趋势性强）
- 极端阈值更加极端

### 阈值更新建议

1. **更新频率**
   - 建议每季度更新一次
   - 使用最近3-5年的历史数据计算

2. **计算方法**
   - 统计行业内所有股票的RSI分布
   - 超买阈值：70-80分位数
   - 超卖阈值：20-30分位数
   - 极端阈值：90/10分位数

3. **验证方法**
   - 回测验证阈值有效性
   - 观察信号触发频率
   - 调整以达到合理的交易频率

---

## 🔧 系统配置 (settings.py)

### 文件位置
`config/settings.py`

### 主要配置项

#### 数据源配置

```python
DATA_SOURCE = {
    'primary': 'akshare',  # 主要数据源
    'backup': None,        # 备用数据源
    'cache_enabled': True, # 是否启用缓存
    'cache_days': 7        # 缓存天数
}
```

#### 策略参数配置

```python
STRATEGY_PARAMS = {
    'timeframe': 'weekly',     # 时间周期：周线
    'position_size': 0.10,     # 单次轮动仓位：10%
    'lookback_period': 13,     # 背离检测回溯周期
    
    # 技术指标参数
    'ema_period': 20,          # EMA周期
    'rsi_period': 14,          # RSI周期
    'macd_fast': 12,           # MACD快线
    'macd_slow': 26,           # MACD慢线
    'macd_signal': 9,          # MACD信号线
    'bb_period': 20,           # 布林带周期
    'bb_std': 2.0,             # 布林带标准差
}
```

#### 日志配置

```python
LOGGING_CONFIG = {
    'level': 'INFO',           # 日志级别
    'format': '%(asctime)s - %(name)s - %(levelname)s - %(message)s',
    'file_path': 'logs/rotation_strategy.log',
    'max_bytes': 10 * 1024 * 1024,  # 10MB
    'backup_count': 5
}
```

#### 输出配置

```python
OUTPUT_CONFIG = {
    'save_signals': True,          # 是否保存信号
    'save_backtest_results': True, # 是否保存回测结果
    'generate_plots': True,        # 是否生成图表
    'output_dir': 'output'         # 输出目录
}
```

---

## 🎨 报告模板配置

### 文件位置
`config/backtest_report_template.html`

### 可定制内容

1. **样式定制**
   - CSS样式
   - 颜色主题
   - 字体大小

2. **图表配置**
   - ECharts图表参数
   - 图表高度和布局
   - 交互功能

3. **内容布局**
   - 报告章节顺序
   - 显示/隐藏某些部分
   - 自定义指标展示

---

## 📝 配置最佳实践

### 1. 配置文件管理

**推荐做法：**
```bash
# 1. 备份原始配置
cp Input/portfolio_config.csv Input/portfolio_config.csv.bak
cp Input/Backtest_settings.csv Input/Backtest_settings.csv.bak

# 2. 创建不同场景的配置
Input/
├── portfolio_config_coal.csv      # 煤炭股配置
├── portfolio_config_bank.csv      # 银行股配置
├── portfolio_config_mixed.csv     # 混合配置
└── Backtest_settings_long.csv     # 长期回测配置
```

### 2. 配置验证

**运行前检查：**
```python
# 创建配置验证脚本
# scripts/validate_config.py

def validate_portfolio_config():
    """验证股票池配置"""
    df = pd.read_csv('Input/portfolio_config.csv')
    
    # 检查权重总和
    total_weight = df['初始权重'].sum()
    assert abs(total_weight - 1.0) < 0.01, f"权重总和应为1.0，当前为{total_weight}"
    
    # 检查DCF估值
    assert df['DCF估值'].notna().all(), "DCF估值不能为空"
    assert (df['DCF估值'] > 0).all(), "DCF估值必须大于0"
    
    print("✅ 配置验证通过")
```

### 3. 参数调优

**系统化调优流程：**

```
1. 基准测试
   ├── 使用默认参数运行
   └── 记录基准性能

2. 单参数调优
   ├── 价值比阈值
   ├── RSI阈值
   └── 仓位比例

3. 组合优化
   ├── 网格搜索
   └── 选择最优组合

4. 回测验证
   ├── 不同时间段
   ├── 不同股票池
   └── 稳定性检验
```

### 4. 配置版本控制

**使用Git管理配置：**
```bash
# .gitignore
data_cache/
logs/
output/
reports/

# 但保留配置文件
!Input/*.csv
!config/settings.py
```

---

## ⚠️ 常见配置错误

### 错误1：权重总和不为1

**错误配置：**
```csv
股票代码,股票名称,初始权重
601088,中国神华,0.3
601225,淮北矿业,0.3
600985,淮矿控股,0.3
```
总和 = 0.9 ❌

**正确配置：**
```csv
股票代码,股票名称,初始权重
601088,中国神华,0.33
601225,淮北矿业,0.33
600985,淮矿控股,0.34
```
总和 = 1.0 ✅

### 错误2：日期格式错误

**错误格式：**
```csv
回测开始日期,2021/01/08    # 使用斜杠
回测开始日期,20210108      # 缺少分隔符
```

**正确格式：**
```csv
回测开始日期,2021-01-08    # 使用连字符
```

### 错误3：DCF估值缺失

**错误：**
```csv
股票代码,股票名称,DCF估值
601088,中国神华,           # 空值
```

**后果：**
- 价值比过滤器失效
- 系统回退到EMA趋势过滤器
- 策略逻辑改变

### 错误4：行业代码不匹配

**错误：**
```csv
股票代码,申万二级行业代码
601088,999999              # 不存在的代码
```

**后果：**
- 使用默认RSI阈值（70/30）
- 失去行业特定优化

---

## 🔗 相关文档

- **架构设计：** `architecture.md`
- **快速上手：** `quick_start_for_developers.md`
- **数据流说明：** `data_flow.md`

---

## 📞 配置支持

如有配置问题，请：
1. 查看本文档
2. 运行配置验证脚本
3. 在项目Issue中提问

---

**文档版本历史：**
- v1.0 (2026-01-16) - 初始版本，阶段0配置说明文档创建
