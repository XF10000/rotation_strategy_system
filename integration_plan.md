# 申万二级行业RSI阈值集成计划

## 当前状态总结

### 已完成的工作
1. ✅ **动态RSI阈值计算模块**
   - 基于156周历史数据计算14周RSI
   - 支持124个申万二级行业
   - 根据波动率分层设置动态阈值
   - 输出文件：`sw_rsi_thresholds/output/sw2_rsi_threshold.csv`

2. ✅ **现有回测系统架构分析**
   - 发现完整的RSI阈值使用框架
   - `IndustryRSILoader`类负责加载阈值配置
   - 信号生成器支持行业特定的RSI阈值
   - 当前使用静态配置：`Input/industry_rsi_thresholds.csv`

3. ✅ **增强版加载器开发**
   - 创建了`EnhancedIndustryRSILoader`类
   - 支持从动态计算的CSV文件读取阈值
   - 保持与原有系统接口的兼容性
   - 添加了备用机制确保系统稳定性

### 数据格式对比

**原有静态配置格式**：
```csv
行业名称,RSI超卖阈值,RSI超买阈值,是否要求背离,极端超卖阈值,极端超买阈值,风险等级,备注
煤炭,28,70,是,25,72,激进型,强周期性行业
```

**新动态计算格式**：
```csv
行业代码,行业名称,layer,volatility,current_rsi,普通超卖,普通超买,极端超卖,极端超买,data_points,更新时间
340500,白酒,低波动,8.527,53.215,47.282,69.082,46.260,70.098,156,2025-08-08 22:45:11
```

## 集成计划

### 第一阶段：信号生成器集成 🔄

**目标**：修改信号生成器使用增强版RSI阈值加载器

**具体步骤**：
1. 修改`strategy/signal_generator.py`中的RSI阈值获取逻辑
2. 将`get_rsi_loader()`替换为`get_enhanced_rsi_loader()`
3. 确保行业映射正确工作
4. 保持向后兼容性

### 第二阶段：行业映射完善 📋

**目标**：建立股票代码到申万二级行业的完整映射

**当前问题**：
- 静态配置使用行业名称（如"煤炭"）
- 动态计算使用申万代码+名称（如"340500,白酒"）
- 需要建立两者之间的映射关系

**解决方案**：
1. 创建行业名称映射表
2. 支持通过行业代码或名称查找阈值
3. 添加模糊匹配机制

### 第三阶段：配置统一 ⚙️

**目标**：统一配置管理，支持动态更新

**具体内容**：
1. 修改全局配置，默认使用动态阈值
2. 保留静态配置作为备用
3. 添加配置重载机制
4. 支持运行时切换阈值来源

### 第四阶段：测试验证 🧪

**目标**：全面测试集成效果

**测试内容**：
1. 单元测试：各个组件独立功能
2. 集成测试：端到端信号生成
3. 回测验证：对比使用静态vs动态阈值的回测结果
4. 性能测试：确保集成不影响回测速度

## 技术实现细节

### 1. 信号生成器修改

```python
# 原有代码
rsi_loader = get_rsi_loader()
rsi_thresholds = rsi_loader.get_rsi_thresholds(industry)

# 修改后
from config.enhanced_industry_rsi_loader import get_enhanced_rsi_loader
enhanced_loader = get_enhanced_rsi_loader()
rsi_thresholds = enhanced_loader.get_rsi_thresholds(industry)
```

### 2. 行业映射增强

```python
# 支持多种查找方式
def get_industry_rsi_thresholds(industry_identifier):
    # 1. 直接匹配行业名称
    # 2. 匹配申万行业代码  
    # 3. 模糊匹配
    # 4. 默认阈值
```

### 3. 配置管理

```python
# 配置文件支持
{
    "rsi_threshold_source": "dynamic",  # dynamic | static | hybrid
    "dynamic_threshold_path": "sw_rsi_thresholds/output/sw2_rsi_threshold.csv",
    "static_threshold_path": "Input/industry_rsi_thresholds.csv"
}
```

## 预期效果

### 1. 更精确的阈值
- 基于156周历史数据的动态计算
- 考虑行业波动率特征
- 自动更新机制

### 2. 更好的信号质量
- 减少假信号
- 提高信号的行业适应性
- 支持极端市场条件

### 3. 系统稳定性
- 保持向后兼容
- 多层备用机制
- 渐进式升级路径

## 风险控制

### 1. 数据质量风险
- **风险**：动态计算数据可能存在异常
- **控制**：多层验证机制，异常时回退到静态配置

### 2. 性能风险
- **风险**：增加计算复杂度影响回测速度
- **控制**：缓存机制，预计算优化

### 3. 兼容性风险
- **风险**：破坏现有系统功能
- **控制**：渐进式集成，保留原有接口

## 下一步行动

1. **立即执行**：修改信号生成器集成增强版加载器
2. **短期目标**：完成基础集成和测试
3. **中期目标**：优化性能和用户体验
4. **长期目标**：建立自动化更新机制

---

**集成优先级**：高
**预计完成时间**：1-2天
**风险等级**：中等（有完善的备用机制）